import{_ as gt,u as _t,l as ht,o as yt,m as wt,a as d,c as v,b as o,t as l,p as kt,g as y,f as L,n as x,q as Ce,F as I,r as R,s as ve,v as F,h as _,x as bt,i as q,y as Te,k as Ct}from"./index-DvnpBeFx.js";import{u as Tt}from"./game-D1BKubuz.js";import{u as St}from"./settings-58WoB_mZ.js";let Z=null,T=null,me=null,fe=[],Se=null;function K(){return Z||(Z=new(window.AudioContext||window.webkitAudioContext)),Z.state==="suspended"&&Z.resume(),Z}function ee(){try{return JSON.parse(localStorage.getItem("game_settings")||"{}")}catch{return{}}}function At(){const f=ee();if(f.soundEffect!==!1)try{const r=K(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.setValueAtTime(800,r.currentTime),c.frequency.exponentialRampToValueAtTime(600,r.currentTime+.05),p.gain.setValueAtTime(.15,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.05),c.start(r.currentTime),c.stop(r.currentTime+.05),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate(10)}catch{}}function Gt(){if(ee().soundEffect!==!1)try{const r=K(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.setValueAtTime(400,r.currentTime),c.frequency.exponentialRampToValueAtTime(200,r.currentTime+.08),p.gain.setValueAtTime(.12,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.08),c.start(r.currentTime),c.stop(r.currentTime+.08)}catch{}}function Lt(){const f=ee();if(f.soundEffect!==!1)try{const r=K(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.value=523.25,p.gain.setValueAtTime(.2,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.15),c.start(r.currentTime),c.stop(r.currentTime+.15);const s=r.createOscillator(),S=r.createGain();s.connect(S),S.connect(r.destination),s.type="sine",s.frequency.value=659.25,S.gain.setValueAtTime(.2,r.currentTime+.1),S.gain.exponentialRampToValueAtTime(.01,r.currentTime+.25),s.start(r.currentTime+.1),s.stop(r.currentTime+.25),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate([30,50,30])}catch{}}function xt(){const f=ee();if(f.soundEffect!==!1)try{const r=K();r.state==="suspended"?r.resume().then(()=>{Be(r)}):Be(r),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate([50,50,50,50,100])}catch(r){console.warn("é€šå…³éŸ³æ•ˆæ’­æ”¾å¤±è´¥:",r)}}function Be(f){[{freq:523.25,time:0},{freq:659.25,time:.15},{freq:783.99,time:.3},{freq:1046.5,time:.45}].forEach(c=>{const p=f.createOscillator(),s=f.createGain();p.connect(s),s.connect(f.destination),p.type="sine",p.frequency.value=c.freq,s.gain.setValueAtTime(.35,f.currentTime+c.time),s.gain.exponentialRampToValueAtTime(.01,f.currentTime+c.time+.3),p.start(f.currentTime+c.time),p.stop(f.currentTime+c.time+.3)})}function Me(f="campaign"){if(ee().bgMusic!==!1)try{let ge=function($){let w=$;return s.forEach(({note:j,duration:P})=>{const Y=S[j];if(!Y||!T)return;const V=c.createOscillator(),B=c.createOscillator(),A=c.createGain();V.type="sine",V.frequency.value=Y,B.type="triangle",B.frequency.value=Y*2;const g=c.createGain();g.gain.value=f==="timed"||f==="pk"?.2:.15,V.connect(A),B.connect(g),g.connect(A),A.connect(T),A.gain.setValueAtTime(0,w),A.gain.linearRampToValueAtTime(.5,w+.05),A.gain.linearRampToValueAtTime(.3,w+P*.5),A.gain.linearRampToValueAtTime(0,w+P-.02),V.start(w),V.stop(w+P),B.start(w),B.stop(w+P),fe.push({osc:V,stopTime:w+P}),fe.push({osc:B,stopTime:w+P}),w+=P}),w},h=function(){if(!T)return;const $=c.currentTime+.1;ge($),me=setTimeout(h,(pe-.3)*1e3)};const c=K();if(Se===f&&T)return;De(),Se=f,fe=[],T=c.createGain(),T.gain.value=0,T.connect(c.destination),T.gain.linearRampToValueAtTime(.08,c.currentTime+.5);let s,S,u;f==="timed"||f==="pk"?(u=.35,s=[{note:"E4",duration:u},{note:"G4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"D4",duration:u},{note:"E4",duration:u*2},{note:"G4",duration:u},{note:"A4",duration:u},{note:"B4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"D4",duration:u*2}],S={D4:293.66,E4:329.63,G4:392,A4:440,B4:493.88}):(u=.8,s=[{note:"C4",duration:u},{note:"E4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"F4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u*1.5},{note:"E4",duration:u*.5},{note:"D4",duration:u},{note:"F4",duration:u},{note:"E4",duration:u},{note:"C4",duration:u},{note:"D4",duration:u},{note:"G3",duration:u},{note:"C4",duration:u*2}],S={G3:196,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440});const pe=s.reduce(($,w)=>$+w.duration,0);h()}catch(c){console.warn("èƒŒæ™¯éŸ³ä¹å¯åŠ¨å¤±è´¥:",c)}}function De(){if(me&&(clearTimeout(me),me=null),Se=null,T){try{const r=K().currentTime;T.gain.cancelScheduledValues(r),T.gain.setValueAtTime(T.gain.value,r),T.gain.linearRampToValueAtTime(0,r+.1);const c=T;setTimeout(()=>{try{c.disconnect()}catch{}},150)}catch{try{T.disconnect()}catch{}}T=null}fe=[]}const It={class:"game-screen"},Et={class:"top-bar"},Nt={class:"game-card-compact"},Pt={class:"top-row-1"},Wt={class:"user-info-mini"},Ot={class:"mini-avatar"},Rt={class:"mini-name"},$t={class:"mini-stats"},Vt={class:"mini-stat",title:"ä½“åŠ›"},Bt={class:"mini-stat",title:"æç¤º"},Mt={class:"mini-stat",title:"å‘éŸ³"},Dt={class:"top-row-2"},qt={class:"game-mode-badge"},Ut={key:0,class:"level-badge"},jt={class:"score-mini"},zt={class:"progress-mini"},Jt={class:"progress-bar-mini"},Ft={class:"progress-text-mini"},Kt={class:"main-content"},Yt={class:"game-card-main"},Ht={class:"flex justify-center"},Qt=["onClick"],Xt={key:0,class:"clue-number"},Zt={key:1,class:"cell-letter"},en={class:"words-section"},tn={class:"words-list"},nn=["onClick"],sn={class:"word-index"},an={class:"word-direction-badge"},on=["onClick"],rn={key:0,class:"word-definition"},ln=["onClick"],cn=["onClick"],un={class:"word-placeholder"},dn={key:0,class:"word-translation-hint"},vn={class:"keyboard-section"},mn={class:"keyboard-wrapper"},fn={class:"keyboard-container"},pn={class:"keyboard-row"},gn=["onClick"],_n={class:"keyboard-row"},hn=["onClick"],yn={class:"keyboard-row"},wn=["onClick"],kn=["disabled"],bn={class:"prop-num"},Cn=["disabled"],Tn={class:"prop-num"},Sn={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},An={class:"complete-modal animate-bounce-in"},Gn={class:"confetti-container"},Ln={class:"trophy-area"},xn={class:"trophy-emoji"},In={class:"stars-row"},En={class:"stars-hint"},Nn={class:"complete-title"},Pn={class:"stats-inline"},Wn={key:0,class:"reward-display"},On={class:"reward-items"},Rn={class:"reward-icon"},$n={class:"reward-value"},Vn={class:"reward-name"},Bn={key:1,class:"all-complete-msg"},Mn={class:"modal-btns three-btns"},Dn=["disabled"],qn={class:"word-detail-card animate-bounce-in"},Un={class:"detail-word"},jn={key:0,class:"detail-phonetic"},zn={class:"detail-speak-btns"},Jn={class:"detail-section"},Fn={class:"detail-content"},Kn={key:1,class:"detail-section"},Yn={class:"detail-content example"},Hn={class:"detail-meta"},Qn={class:"meta-badge"},Xn={class:"meta-badge"},Zn={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},es={class:"energy-modal animate-bounce-in"},ts={class:"energy-modal-info"},ns={class:"energy-current"},ss={class:"energy-need"},as={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},os={__name:"Game",setup(f,{expose:r}){const c=bt(),p=Ct(),s=Tt(),S=St(),u=_t(),pe=q(()=>u.avatar||"ğŸ˜Š"),ge=q(()=>u.nickname||"æ¸¸å®¢"),h=_(100),$={campaign:5,timed:15,pk:15,endless:30};function w(){try{const e=localStorage.getItem("user_energy");if(e){const t=JSON.parse(e);h.value=t.value??100}}catch{h.value=100}}async function j(e){h.value=e;try{const t=new Date().toISOString().split("T")[0],n={value:e,date:t};localStorage.setItem("user_energy",JSON.stringify(n))}catch(t){console.error("ä¿å­˜ä½“åŠ›å¤±è´¥:",t)}try{await fetch("/api/user/energy",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({energy:e})})}catch(t){console.error("åŒæ­¥ä½“åŠ›åˆ°åç«¯å¤±è´¥:",t)}}async function P(e){const t=$[e]||5;if(h.value<t)return se.value={required:t,current:h.value},ne.value=!0,!1;const n=h.value-t;await j(n);try{await fetch(`/api/user/energy/consume?mode=${e}`,{method:"POST"})}catch(a){console.error("åç«¯è®°å½•ä½“åŠ›æ¶ˆè€—å¤±è´¥:",a)}return!0}function Y(){ne.value=!1,s.resetGame(),p.push("/")}async function V(){try{const a=await fetch("/api/user/energy/claim-free",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:10})});if(a.ok){const i=await a.json();h.value=i.energy,localStorage.setItem("user_energy",JSON.stringify({value:i.energy,date:new Date().toISOString().split("T")[0]}))}else{const i=Math.min(100,h.value+10);await j(i)}}catch(a){console.error("é¢†å–ä½“åŠ›å¤±è´¥:",a);const i=Math.min(100,h.value+10);await j(i)}const t=c.params.mode||"campaign",n=$[t]||5;if(h.value>=n){ne.value=!1;const a=h.value-n;await j(a);try{await fetch(`/api/user/energy/consume?mode=${t}`,{method:"POST"})}catch(i){console.error("åç«¯è®°å½•ä½“åŠ›æ¶ˆè€—å¤±è´¥:",i)}await B(t)}else se.value={required:n,current:h.value}}async function B(e){const n=localStorage.getItem("current_group")||s.currentGroup||"primary";s.currentGroup=n;let a=1;if(S.bgMusic&&Me(e),e==="campaign"&&await Ve(n),e==="campaign"){const m=localStorage.getItem(`campaign_level_${n}`);m&&(a=parseInt(m))}else if(e==="endless"){const m=localStorage.getItem("endless_level");m&&(a=parseInt(m))}const i=localStorage.getItem("game_difficulty")||"medium",C=e==="timed"?180:300;await s.loadPuzzle(e,a,n,C,i),A.value=!1,s.checkAllWords(),e==="timed"?s.startTimer(C):s.startTimer(0),le()}const A=_(!0),g=_(null),k=_(0),b=_(0),te=_(!1),Ae=_({}),_e=_(!1),G=_(null),ne=_(!1),se=_({required:5,current:0}),ae=_(!1),H=_(!1),E=_(20),N=_(20),he=_(null),Q=_(0),qe=q(()=>({campaign:"ğŸ°",endless:"â™¾ï¸",timed:"â±ï¸",pk:"âš”ï¸"})[s.currentMode]||"ğŸ®"),Ue=q(()=>({campaign:"é—¯å…³",endless:"æ— é™",timed:"è®¡æ—¶",pk:"PK"})[s.currentMode]||"æ¸¸æˆ"),je=q(()=>s.currentMode==="timed"||s.currentMode==="pk"?s.timer<60:!1),ye=q(()=>!s.words||s.words.length===0?[]:[...s.words].sort((e,t)=>{const n=e.clue_number||999,a=t.clue_number||999;return n!==a?n-a:e.direction!==t.direction?e.direction==="across"?-1:1:0})),M=q(()=>{const e=s.timer;return e<=120?3:e<=180?2:1}),oe=_(180),re=q(()=>s.currentMode==="campaign"&&s.currentLevel>=oe.value),ie=_(!1),W=_(!1),U=_([]);async function ze(){try{const t=await F.post("/api/game/generate-reward",{},{withCredentials:!0});if(t.data.success)return t.data.rewards}catch(e){console.error("è·å–å¥–åŠ±å¤±è´¥:",e)}return[{type:"energy",name:"ä½“åŠ›",icon:"âš¡",value:5},{type:"hint",name:"æç¤º",icon:"ğŸ’¡",value:1}]}async function Je(){if(!W.value&&U.value.length!==0)try{const t=await F.post("/api/game/claim-reward",{level:s.currentLevel,vocab_group:s.vocabGroup,stars:levelStars.value,time_seconds:s.timer},{withCredentials:!0});if(t.data.success){U.value=t.data.rewards;const n=t.data.updated_data;n&&(h.value=n.energy,n.props&&(E.value=n.props.hintLetterCount,N.value=n.props.showTranslationCount)),await Qe(s.score),W.value=!0}}catch(e){console.error("é¢†å–å¥–åŠ±å¤±è´¥:",e),W.value=!0}}async function Fe(){te.value=!1,ie.value=!1,W.value=!1,U.value=[],Le(),s.nextLevel(),Te(()=>{le()})}function le(){const e=ye.value.filter(t=>!z(t.id));e.length>0&&ue(e[0])}function we(e){var n;return!ae.value||!g.value||g.value.id!==he.value?!1:(((n=g.value.word)==null?void 0:n.toUpperCase())||"").includes(e)}function Ke(){E.value<=0||g.value&&(ae.value=!0,he.value=g.value.id,E.value--,ce())}function Ye(){if(N.value<=0||!g.value||H.value)return;H.value=!0,N.value--,ce();const e=g.value.word;Q.value=0,Ge(e,3)}function Ge(e,t){if(Q.value>=t){H.value=!1,Q.value=0;return}Q.value++,s.speakWord(e),setTimeout(()=>{Ge(e,t)},1200)}function He(){try{const e=localStorage.getItem("game_props");if(e){const t=JSON.parse(e);E.value=t.hintLetterCount??20,N.value=t.speakPropCount??20}else E.value=20,N.value=20,ce()}catch{E.value=20,N.value=20}}function ce(){try{const e={hintLetterCount:E.value,speakPropCount:N.value};localStorage.setItem("game_props",JSON.stringify(e))}catch{}}async function Qe(e){try{await fetch("/api/game/score",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({score:e,vocab_group:s.currentGroup,level:s.currentLevel})}),console.log("ç§¯åˆ†åŒæ­¥æˆåŠŸ")}catch(t){console.error("åŒæ­¥ç§¯åˆ†åˆ°åç«¯å¤±è´¥:",t)}}async function Xe(){try{const e=await fetch("/api/user/energy",{credentials:"include"});if(e.ok){const n=await e.json();n.energy!==void 0&&(h.value=n.energy,localStorage.setItem("user_energy",JSON.stringify({value:n.energy,date:new Date().toISOString().split("T")[0]})))}const t=await fetch("/api/user/props",{credentials:"include"});if(t.ok){const n=await t.json();n.hintLetterCount!==void 0&&(E.value=n.hintLetterCount,N.value=n.showTranslationCount||20,ce())}}catch(e){console.warn("ä»åç«¯åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:",e)}}function Le(){ae.value=!1,H.value=!1,he.value=null,Q.value=0}function Ze(e){const t=e.length,n=[];for(let a=0;a<t;a++){let i=e.start_row,C=e.start_col;e.direction==="across"?C+=a:i+=a;const m=s.getAnswer(i,C);m?n.push(m):n.push("_")}return n}function xe(e,t){const n=s.clueNumbers;return!n||!n[e]?null:n[e][t]}function et(e,t,n){const a=["letter-cell-new"];if(n===null)return a.push("empty"),a.join(" ");const i=s.isPrefilledCell(e,t);return tt(e,t)?a.push("locked"):i?a.push("prefilled"):nt(e,t)?a.push("active"):st(e,t)&&a.push("in-word"),a.join(" ")}function tt(e,t){for(const n of s.completedWords)if(n.direction==="across"){if(e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length)return!0}else if(t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length)return!0;return!1}function nt(e,t){return e===k.value&&t===b.value}function st(e,t){if(!g.value)return!1;const n=g.value;return n.direction==="across"?e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length:t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length}function O(e,t){return!!s.isPrefilledCell(e,t)}function z(e){return s.completedWords.some(t=>t.id===e)}function Ie(e){return s.completedWords.find(n=>n.id===e)||{}}function at(e,t,n){n!==null&&(O(e,t)||(k.value=e,b.value=t,ot(e,t)))}function ot(e,t){for(const n of s.words)if(n.direction==="across"&&e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length){g.value=n;return}for(const n of s.words)if(n.direction==="down"&&t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length){g.value=n;return}}function ue(e){g.value=e,Te(()=>{const t=Ae.value[e.id];t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})});for(let t=0;t<e.length;t++){let n=e.start_row,a=e.start_col;if(e.direction==="across"?a+=t:n+=t,!O(n,a)){k.value=n,b.value=a;return}}k.value=e.start_row,b.value=e.start_col}function ke(e){O(k.value,b.value)||(s.setAnswer(k.value,b.value,e),de("type"),lt(k.value,b.value),it())}function rt(){if(O(k.value,b.value)){Ee();return}de("delete"),s.getAnswer(k.value,b.value)?s.setAnswer(k.value,b.value,""):(Ee(),O(k.value,b.value)||s.setAnswer(k.value,b.value,""))}function it(){if(!g.value)return;const e=g.value;if(e.direction==="across"){let t=b.value+1;for(;t<e.start_col+e.length&&O(e.start_row,t);)t++;t<e.start_col+e.length?b.value=t:Ne()}else{let t=k.value+1;for(;t<e.start_row+e.length&&O(t,e.start_col);)t++;t<e.start_row+e.length?k.value=t:Ne()}}function Ee(){if(!g.value)return;const e=g.value;if(e.direction==="across"){let t=b.value-1;for(;t>=e.start_col&&O(e.start_row,t);)t--;t>=e.start_col&&(b.value=t)}else{let t=k.value-1;for(;t>=e.start_row&&O(t,e.start_col);)t--;t>=e.start_row&&(k.value=t)}}function Ne(){const e=ye.value.filter(t=>!z(t.id));if(e.length>0){const n=(e.findIndex(a=>{var i;return a.id===((i=g.value)==null?void 0:i.id)})+1)%e.length;ue(e[n])}}function lt(e,t){let n=!1,a=[];for(const i of s.words){if(z(i.id))continue;s.checkWord(i.id)&&(n=!0,a.push(i.id))}n&&(de("correct"),g.value&&a.includes(g.value.id)&&Te(()=>{le()}))}function be(e,t=null){s.speakWord(e,t)}function Pe(e){G.value=e,_e.value=!0}function We(){_e.value=!1,G.value=null}function de(e){switch(e){case"type":At();break;case"correct":Lt();break;case"delete":Gt();break;case"levelComplete":xt();break}}function Oe(){s.resetGame(),p.push("/")}function ct(){te.value=!1,s.loadPuzzle("campaign",s.currentLevel,s.currentGroup),s.startTimer(),s.words.length>0&&ue(s.words[0])}ht(()=>s.isLevelComplete,async e=>{if(e){s.stopTimer(),de("levelComplete");const t=s.completedWords.length,n=t*10;await mt(s.currentMode,t,n),s.currentMode==="campaign"?(s.saveLevelProgress(s.currentLevel),await J("campaign_level",s.currentLevel),await J("campaign_score",n)):s.currentMode==="endless"?(ut(),await J("endless_level",X.value),await J("endless_score",n)):s.currentMode==="timed"&&(await J("timed_words",t),await J("timed_score",n)),ft(t,n),U.value=await ze(),ie.value=!0,W.value=!1,setTimeout(()=>{te.value=!0},500)}});const X=_(1);function ut(){X.value++,localStorage.setItem("endless_level_count",X.value.toString())}function dt(){const e=localStorage.getItem("endless_level_count");e&&(X.value=parseInt(e)||1)}async function J(e,t){try{const n=Re(),a=$e();if(!n)return;await F.post(`/api/leaderboard/${e}/submit`,{user_id:n,nickname:a.nickname||"æ¸¸å®¢",avatar:a.avatar||"ğŸ˜Š",group:s.currentGroup,value:t,extra:{time:s.timer,level:s.currentLevel}}),console.log(`æ’è¡Œæ¦œæäº¤æˆåŠŸ: ${e} = ${t}`)}catch(n){console.error("æ’è¡Œæ¦œæäº¤å¤±è´¥:",n)}}async function vt(e){try{const t=Re(),n=$e();if(!t)return;const a="";await F.post(`${a}/api/game/pk-result`,{vocab_group:s.currentGroup,result:e,words_count:s.completedWords.length,duration_seconds:s.timer},{withCredentials:!0}),await F.post(`${a}/api/leaderboard/pk/submit`,{user_id:t,nickname:n.nickname||"æ¸¸å®¢",avatar:n.avatar||"ğŸ˜Š",group:s.currentGroup,result:e}),pt(e),console.log(`PKç»“æœæäº¤æˆåŠŸ: ${e}`)}catch(t){console.error("PKç»“æœæäº¤å¤±è´¥:",t)}}async function mt(e,t,n){try{const a="";let i=0;e==="campaign"?i=s.currentLevel:e==="endless"&&(i=X.value),await F.post(`${a}/api/game/submit`,{game_mode:e,vocab_group:s.currentGroup,score:n,words_count:t,level_reached:i,duration_seconds:s.timer,result:null,extra_data:{grid_size:s.gridSize,difficulty:s.currentDifficulty}},{withCredentials:!0}),console.log(`æ¸¸æˆæ•°æ®æäº¤æˆåŠŸ: ${e}, åˆ†æ•°=${n}`)}catch(a){console.error("æ¸¸æˆæ•°æ®æäº¤å¤±è´¥:",a)}}function Re(){const e=document.cookie.match(/user_id=([^;]+)/);return e?e[1]:null}function $e(){try{const e=localStorage.getItem("user_info");if(e)return JSON.parse(e)}catch{}return{nickname:"æ¸¸å®¢",avatar:"ğŸ˜Š"}}function ft(e,t){try{const n="myStats";let a={totalGames:0,totalWords:0,totalScore:0,highScore:0,campaignLevel:1};const i=localStorage.getItem(n);i&&(a=JSON.parse(i)),a.totalGames=(a.totalGames||0)+1,a.totalWords=(a.totalWords||0)+e,a.totalScore=(a.totalScore||0)+t,t>(a.highScore||0)&&(a.highScore=t),s.currentMode==="campaign"&&s.currentLevel>(a.campaignLevel||1)&&(a.campaignLevel=s.currentLevel),localStorage.setItem(n,JSON.stringify(a))}catch(n){console.error("ä¿å­˜ç»Ÿè®¡å¤±è´¥:",n)}}function pt(e){try{const t="pk_stats";let n={wins:0,draws:0,losses:0,games:0};const a=localStorage.getItem(t);a&&(n=JSON.parse(a)),n.games=(n.games||0)+1,e==="win"?n.wins=(n.wins||0)+1:e==="draw"?n.draws=(n.draws||0)+1:n.losses=(n.losses||0)+1,localStorage.setItem(t,JSON.stringify(n))}catch(t){console.error("ä¿å­˜PKç»Ÿè®¡å¤±è´¥:",t)}}r({submitPKResult:vt});async function Ve(e){try{const t=await s.getGroupLevelCount(e);t>0?oe.value=t:oe.value=180}catch(t){console.warn("è·å–å…³å¡æ€»æ•°å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼",t),oe.value=180}}return yt(async()=>{A.value=!0,He(),w(),await Xe(),dt(),Le(),ie.value=!1,W.value=!1,U.value=[];const e=c.params.mode,n=localStorage.getItem("current_group")||s.currentGroup||"primary";s.currentGroup=n;let a=1;if(!await P(e)){A.value=!1;return}if(S.bgMusic&&Me(e),e==="campaign"&&await Ve(n),e==="campaign"){const D=localStorage.getItem(`campaign_level_${n}`);D&&(a=parseInt(D))}else if(e==="endless"){const D=localStorage.getItem("endless_level");D&&(a=parseInt(D))}const C=localStorage.getItem("game_difficulty")||"medium",m=e==="timed"?180:300;await s.loadPuzzle(e,a,n,m,C),A.value=!1,s.checkAllWords(),e==="timed"?s.startTimer(m):s.startTimer(0),le()}),wt(()=>{s.stopTimer(),De()}),(e,t)=>{var n;return d(),v("div",It,[o("div",Et,[o("div",Nt,[o("div",Pt,[o("button",{onClick:Oe,class:"back-btn-icon",title:"è¿”å›"}," â† "),o("div",Wt,[o("span",Ot,l(pe.value),1),o("span",Rt,l(ge.value),1)]),o("div",$t,[o("span",Vt,"âš¡"+l(h.value),1),o("span",Bt,"ğŸ’¡"+l(E.value),1),o("span",Mt,"ğŸ”Š"+l(N.value),1)])]),o("div",Dt,[o("div",qt,[kt(l(qe.value)+" "+l(Ue.value)+" ",1),y(s).currentMode==="campaign"?(d(),v("span",Ut," L"+l(y(s).currentLevel),1)):L("",!0)]),o("div",{class:x(["timer-mini",{warning:je.value}])}," â±ï¸"+l(y(s).formattedTimer),3),o("div",jt,"ğŸŒŸ"+l(y(s).score),1),o("div",zt,[o("div",Jt,[o("div",{class:"progress-fill-mini",style:Ce({width:y(s).progress+"%"})},null,4)]),o("span",Ft,l(y(s).completedWords.length)+"/"+l(y(s).words.length),1)])])])]),o("div",Kt,[o("div",Yt,[o("div",Ht,[o("div",{class:"grid gap-1",style:Ce({gridTemplateColumns:`repeat(${y(s).gridSize}, minmax(0, 1fr))`,maxWidth:`${y(s).gridSize*48}px`})},[(d(!0),v(I,null,R(y(s).cells,(a,i)=>(d(),v("div",{key:"row-"+i,class:"contents"},[(d(!0),v(I,null,R(a,(C,m)=>(d(),v("div",{key:`${i}-${m}`,class:x(et(i,m,C)),onClick:D=>at(i,m,C)},[xe(i,m)?(d(),v("span",Xt,l(xe(i,m)),1)):L("",!0),C!==null?(d(),v("span",Zt,l(y(s).getAnswer(i,m)),1)):L("",!0)],10,Qt))),128))]))),128))],4)])]),o("div",en,[o("div",tn,[(d(!0),v(I,null,R(ye.value,(a,i)=>{var C;return d(),v("div",{key:a.id,ref_for:!0,ref:m=>{m&&(Ae.value[a.id]=m)},class:x(["word-item",{completed:z(a.id),selected:((C=g.value)==null?void 0:C.id)===a.id}]),onClick:m=>!z(a.id)&&ue(a)},[o("span",sn,l(a.clue_number||i+1),1),o("span",an,l(a.direction==="across"?"æ¨ª":"ç«–"),1),z(a.id)?(d(),v(I,{key:0},[o("span",{class:"word-text",onClick:ve(m=>Pe(Ie(a.id)),["stop"])},l(a.word),9,on),y(S).showTranslation?(d(),v("span",rn,l(a.definition),1)):L("",!0),o("button",{onClick:ve(m=>Pe(Ie(a.id)),["stop"]),class:"detail-btn",title:"æŸ¥çœ‹è¯¦æƒ…"}," ğŸ“– ",8,ln),o("button",{onClick:ve(m=>be(a.word),["stop"]),class:"speak-btn",title:"å‘éŸ³"}," ğŸ”Š ",8,cn)],64)):(d(),v(I,{key:1},[o("span",un,[(d(!0),v(I,null,R(Ze(a),(m,D)=>(d(),v("span",{key:D,class:x(["placeholder-char",{"hint-letter":m!=="_"}])},l(m),3))),128))]),y(S).showTranslation?(d(),v("span",dn,l(a.definition),1)):L("",!0)],64))],10,nn)}),128))])])]),o("div",vn,[o("div",mn,[o("div",fn,[o("div",pn,[(d(),v(I,null,R("QWERTYUIOP",a=>o("button",{key:a,onClick:i=>ke(a),class:x(["keyboard-key-new",{"key-highlight":we(a)}])},l(a),11,gn)),64))]),o("div",_n,[(d(),v(I,null,R("ASDFGHJKL",a=>o("button",{key:a,onClick:i=>ke(a),class:x(["keyboard-key-new",{"key-highlight":we(a)}])},l(a),11,hn)),64)),o("button",{onClick:rt,class:"keyboard-key-new delete-key"}," âŒ« ")]),o("div",yn,[(d(),v(I,null,R("ZXCVBNM",a=>o("button",{key:a,onClick:i=>ke(a),class:x(["keyboard-key-new",{"key-highlight":we(a)}])},l(a),11,wn)),64)),o("button",{onClick:Ke,disabled:E.value<=0,class:x(["keyboard-prop-btn",{active:ae.value}])},[t[2]||(t[2]=o("span",{class:"prop-emoji"},"ğŸ’¡",-1)),o("span",bn,l(E.value),1)],10,kn),o("button",{onClick:Ye,disabled:N.value<=0||!g.value,class:x(["keyboard-prop-btn",{active:H.value}])},[t[3]||(t[3]=o("span",{class:"prop-emoji"},"ğŸ”Š",-1)),o("span",Tn,l(N.value),1)],10,Cn)])])])]),te.value?(d(),v("div",Sn,[o("div",An,[o("div",Gn,[(d(),v(I,null,R(12,a=>o("span",{key:a,class:"confetti",style:Ce({"--delay":a*.1+"s","--x":Math.random()*200-100+"px"})},"ğŸŠ",4)),64))]),o("div",Ln,[o("div",xn,l(re.value?"ğŸ†":"ğŸ‰"),1),o("div",In,[o("span",{class:x(["star",{earned:M.value>=1}])},l(M.value>=1?"â­":"â˜†"),3),o("span",{class:x(["star","big",{earned:M.value>=2}])},l(M.value>=2?"â­":"â˜†"),3),o("span",{class:x(["star",{earned:M.value>=3}])},l(M.value>=3?"â­":"â˜†"),3)]),o("div",En,l(M.value===3?"å®Œç¾ï¼":M.value===2?"å¾ˆæ£’ï¼":"ç»§ç»­åŠ æ²¹ï¼"),1)]),o("h2",Nn,l(re.value?"æ­å–œå…¨éƒ¨é€šå…³ï¼":`ç¬¬${y(s).currentLevel}å…³ é€šå…³ï¼`),1),o("div",Pn," â±ï¸"+l(y(s).formattedTimer)+" Â· ğŸŒŸ"+l(y(s).score)+"åˆ† Â· ğŸ“"+l(y(s).completedWords.length)+"è¯ ",1),ie.value&&U.value.length>0?(d(),v("div",Wn,[t[4]||(t[4]=o("div",{class:"reward-title"},"ğŸ è·å¾—å¥–åŠ±",-1)),o("div",On,[(d(!0),v(I,null,R(U.value,(a,i)=>(d(),v("div",{key:i,class:"reward-item"},[o("span",Rn,l(a.icon),1),o("span",$n,"+"+l(a.value),1),o("span",Vn,l(a.name),1)]))),128))])])):L("",!0),re.value?(d(),v("p",Bn,"ğŸŒŸ å¤ªæ£’äº†ï¼ä½ å·²å®Œæˆå…¨éƒ¨å…³å¡ï¼")):L("",!0),o("div",Mn,[o("button",{onClick:Oe,class:"modal-btn secondary small"}," è¿”å› "),re.value?(d(),v("button",{key:1,onClick:ct,class:"modal-btn success small"}," å†ç©ä¸€æ¬¡ ")):(d(),v(I,{key:0},[o("button",{onClick:Je,class:x(["modal-btn reward small",{claimed:W.value}]),disabled:W.value},l(W.value?"å·²é¢†å–":"é¢†å¥–"),11,Dn),o("button",{onClick:Fe,class:"modal-btn primary small"}," ä¸‹ä¸€å…³ ")],64))])])])):L("",!0),_e.value&&G.value?(d(),v("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:ve(We,["self"])},[o("div",qn,[o("button",{onClick:We,class:"detail-close-btn"},"Ã—"),o("div",Un,l((n=G.value.word)==null?void 0:n.toUpperCase()),1),G.value.phonetic?(d(),v("div",jn,l(G.value.phonetic),1)):L("",!0),o("div",zn,[o("button",{onClick:t[0]||(t[0]=a=>be(G.value.word,"us")),class:"detail-speak-btn us"}," ğŸ”Š ç¾éŸ³ "),o("button",{onClick:t[1]||(t[1]=a=>be(G.value.word,"uk")),class:"detail-speak-btn uk"}," ğŸ”Š è‹±éŸ³ ")]),o("div",Jn,[t[5]||(t[5]=o("div",{class:"detail-label"},"ğŸ“– é‡Šä¹‰",-1)),o("div",Fn,l(G.value.definition),1)]),G.value.example?(d(),v("div",Kn,[t[6]||(t[6]=o("div",{class:"detail-label"},"ğŸ“ ä¾‹å¥",-1)),o("div",Yn,l(G.value.example),1)])):L("",!0),o("div",Hn,[o("span",Qn,l(G.value.length)+" å­—æ¯",1),o("span",Xn,l(G.value.direction==="across"?"æ¨ªå‘ â†’":"çºµå‘ â†“"),1)])])])):L("",!0),ne.value?(d(),v("div",Zn,[o("div",es,[t[7]||(t[7]=o("div",{class:"energy-modal-icon"},"ğŸ˜´",-1)),t[8]||(t[8]=o("h3",{class:"energy-modal-title"},"ä½“åŠ›ä¸è¶³",-1)),t[9]||(t[9]=o("p",{class:"energy-modal-text"}," å½“å‰ä½“åŠ›ä¸è¶³ä»¥å¼€å§‹æ¸¸æˆ ",-1)),o("div",ts,[o("span",ns,"å½“å‰ä½“åŠ›: âš¡"+l(se.value.current),1),o("span",ss,"éœ€è¦: âš¡"+l(se.value.required),1)]),o("div",{class:"energy-modal-buttons"},[o("button",{onClick:V,class:"energy-modal-btn energy-claim-btn"}," ğŸ é¢†å–ä½“åŠ› +10 "),o("button",{onClick:Y,class:"energy-modal-btn energy-rest-btn"}," ä¼‘æ¯ä¸€ä¸‹ ")])])])):L("",!0),A.value?(d(),v("div",as,[...t[10]||(t[10]=[o("div",{class:"game-card text-center"},[o("div",{class:"text-4xl animate-spin mb-4"},"â³"),o("p",{class:"text-gray-600"},"æ­£åœ¨åŠ è½½å…³å¡...")],-1)])])):L("",!0)])}}},cs=gt(os,[["__scopeId","data-v-fe89c363"]]);export{cs as default};
