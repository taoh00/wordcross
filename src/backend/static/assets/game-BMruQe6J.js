import{C as te,h as i,i as g,v as ae}from"./index-DYfv8LOO.js";const S="",se=te("game",()=>{const h=i("primary"),v=i("campaign"),y=i(1),c=i(null),m=i({}),_=i({}),d=i([]),p=i(0),f=i(0),k=i(!1),w=i(null),$=i({}),z=i(null),K=i([{code:"primary",name:"å°å­¦è¯æ±‡",icon:"ğŸ“š",hasSubGroups:!0,subGroups:[{code:"primary_all",name:"å…¨éƒ¨",icon:"ğŸ“š"},{code:"grade3_1",name:"ä¸‰å¹´çº§ä¸Šå†Œ",icon:"ğŸŒ±"},{code:"grade3_2",name:"ä¸‰å¹´çº§ä¸‹å†Œ",icon:"ğŸŒ¿"},{code:"grade4_1",name:"å››å¹´çº§ä¸Šå†Œ",icon:"ğŸŒ²"},{code:"grade4_2",name:"å››å¹´çº§ä¸‹å†Œ",icon:"ğŸŒ³"},{code:"grade5_1",name:"äº”å¹´çº§ä¸Šå†Œ",icon:"ğŸŒ´"},{code:"grade5_2",name:"äº”å¹´çº§ä¸‹å†Œ",icon:"ğŸŒµ"},{code:"grade6_1",name:"å…­å¹´çº§ä¸Šå†Œ",icon:"ğŸ„"},{code:"grade6_2",name:"å…­å¹´çº§ä¸‹å†Œ",icon:"ğŸ‹"}]},{code:"junior",name:"åˆä¸­è¯æ±‡",icon:"ğŸ“–",hasSubGroups:!0,subGroups:[{code:"junior_all",name:"å…¨éƒ¨",icon:"ğŸ“–"},{code:"junior7_1",name:"ä¸ƒå¹´çº§ä¸Šå†Œ",icon:"ğŸŒ±"},{code:"junior7_2",name:"ä¸ƒå¹´çº§ä¸‹å†Œ",icon:"ğŸŒ¿"},{code:"junior8_1",name:"å…«å¹´çº§ä¸Šå†Œ",icon:"ğŸŒ²"},{code:"junior8_2",name:"å…«å¹´çº§ä¸‹å†Œ",icon:"ğŸŒ³"},{code:"junior9",name:"ä¹å¹´çº§å…¨å†Œ",icon:"ğŸŒ´"}]},{code:"senior",name:"é«˜ä¸­è¯æ±‡",icon:"ğŸ“•",hasSubGroups:!0,subGroups:[{code:"senior_all",name:"å…¨éƒ¨",icon:"ğŸ“•"},{code:"senior1",name:"å¿…ä¿®1",icon:"ğŸ“—"},{code:"senior2",name:"å¿…ä¿®2",icon:"ğŸ“˜"},{code:"senior3",name:"å¿…ä¿®3",icon:"ğŸ“™"},{code:"senior4",name:"å¿…ä¿®4",icon:"ğŸ“”"},{code:"senior5",name:"å¿…ä¿®5",icon:"ğŸ““"}]},{code:"ket",name:"KETè€ƒè¯•",icon:"ğŸ¯"},{code:"pet",name:"PETè€ƒè¯•",icon:"ğŸ“"},{code:"cet4",name:"å¤§å­¦å››çº§",icon:"ğŸ›ï¸"},{code:"cet6",name:"å¤§å­¦å…­çº§",icon:"ğŸ–ï¸"},{code:"postgrad",name:"è€ƒç ”è¯æ±‡",icon:"ğŸ”¬"},{code:"ielts",name:"é›…æ€",icon:"âœˆï¸"},{code:"toefl",name:"æ‰˜ç¦",icon:"ğŸ—½"},{code:"gre",name:"GRE",icon:"ğŸ©"}]),M=g(()=>{var e;return((e=c.value)==null?void 0:e.grid_size)||5}),I=g(()=>{var e;return((e=c.value)==null?void 0:e.words)||[]}),R=g(()=>{var e;return((e=c.value)==null?void 0:e.cells)||[]}),H=g(()=>{var e;return((e=c.value)==null?void 0:e.clue_numbers)||[]}),N=g(()=>{var e,o;return(o=(e=c.value)==null?void 0:e.words)!=null&&o.length?Math.round(d.value.length/c.value.words.length*100):0}),B=g(()=>{var e,o;return(o=(e=c.value)==null?void 0:e.words)!=null&&o.length?d.value.length===c.value.words.length:!1}),q=g(()=>{const e=Math.floor(f.value/60),o=f.value%60;return`${e.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`});async function b(e,o){const a=`${e}_${o}`;if($.value[a])return $.value[a];try{console.log(`åŠ è½½å…³å¡: ${e}/${o}`);const t=await fetch(`/data/levels/${e}/${o}.json`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();return n&&n.words?($.value[a]=n,console.log(`å…³å¡ ${e}/${o} åŠ è½½å®Œæˆ`),n):(console.warn(`å…³å¡ ${e}/${o} æ•°æ®æ ¼å¼é”™è¯¯`),null)}catch(t){return console.error(`åŠ è½½å…³å¡ ${e}/${o} å¤±è´¥:`,t),null}}async function T(e,o,a=2){const t=[];for(let n=o;n<=o+a;n++){const r=`${e}_${n}`;$.value[r]||t.push(b(e,n))}t.length>0&&await Promise.all(t)}async function F(){if(z.value)return z.value;try{const e=await fetch("/data/levels_summary.json");if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();return z.value=o,o}catch(e){return console.error("åŠ è½½å…³å¡æ±‡æ€»å¤±è´¥:",e),null}}async function W(e){try{const o=await F();if(o&&o.groups){const a=o.groups.find(t=>t.group_code===e);return a?a.level_count:0}}catch(o){console.error("è·å–å…³å¡æ•°é‡å¤±è´¥:",o)}return 0}async function Q(e){const o=await W(e);return console.log(`è¯åº“ ${e} å…± ${o} å…³ï¼ˆæŒ‰éœ€åŠ è½½æ¨¡å¼ï¼‰`),o}async function C(e,o=1,a="primary",t=180,n="medium"){v.value=e,y.value=o,h.value=a;const r=n||localStorage.getItem("game_difficulty")||"medium";try{let s=null;if(e==="campaign"){const l=await b(a,o);if(l&&l.words)s={grid_size:l.grid_size,cells:l.cells,words:l.words,prefilled:l.prefilled||{},level:l.level||o,difficulty:"campaign",group:a},T(a,o+1,1);else throw new Error(`å…³å¡ ${o} æ•°æ®ä¸å­˜åœ¨`)}else{let l="";switch(e){case"endless":l=`${S}/api/endless/puzzle?group=${a}&difficulty=${r}`;break;case"timed":l=`${S}/api/timed/puzzle?group=${a}&duration=180&difficulty=${r}`;break;case"pk":l=`${S}/api/endless/puzzle?group=${a}&difficulty=${r}`;break;default:l=`${S}/api/endless/puzzle?group=${a}&difficulty=${r}`}s=(await ae.get(l)).data}if(s&&s.words&&s.words.length>0)c.value=s,console.log("å…³å¡åŠ è½½æˆåŠŸ:",{level:o,mode:e,words:s.words.map(l=>l.word),grid_size:s.grid_size});else throw console.error("è¿”å›æ•°æ®æ ¼å¼é”™è¯¯:",s),new Error("å…³å¡æ•°æ®æ ¼å¼é”™è¯¯");return m.value={},_.value={},d.value=[],p.value=0,V(),!0}catch(s){return console.error("åŠ è½½å…³å¡å¤±è´¥:",s),alert("åŠ è½½å…³å¡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ååˆ·æ–°é¡µé¢é‡è¯•"),!1}}function V(){var o,a;if(!((o=c.value)!=null&&o.cells)||!((a=c.value)!=null&&a.prefilled))return;const e=c.value.prefilled;for(const t of Object.keys(e)){const n=e[t];_.value[t]=!0,m.value[t]=n}}function X(e,o){const a=`${e}-${o}`;return _.value[a]===!0}function Y(e,o,a){const t=`${e}-${o}`,n=m.value[t];m.value[t]=a.toUpperCase(),n&&n!==a.toUpperCase()&&Z(e,o)}function Z(e,o){const a=[];for(const t of d.value){let n=!1;t.direction==="across"?n=e===t.start_row&&o>=t.start_col&&o<t.start_col+t.length:n=o===t.start_col&&e>=t.start_row&&e<t.start_row+t.length,n&&a.push(t.id)}for(const t of a){const n=d.value.findIndex(r=>r.id===t);if(n!==-1){const r=d.value[n];p.value-=r.length*10,d.value.splice(n,1)}}}function x(e,o){const a=`${e}-${o}`;return m.value[a]||""}function L(e){const o=I.value.find(n=>n.id===e);if(!o)return!1;if(d.value.find(n=>n.id===e))return!0;let a="";for(let n=0;n<o.length;n++){let r=o.start_row,s=o.start_col;o.direction==="across"?s+=n:r+=n,a+=x(r,s)}const t=a.toUpperCase()===o.word.toUpperCase();if(t){const n={...o,matchedWord:o.word,matchedDefinition:o.definition,isAlternative:!1};d.value.push(n),p.value+=o.length*10;try{JSON.parse(localStorage.getItem("game_settings")||"{}").autoSpeak!==!1&&j(o.word)}catch{j(o.word)}}return t}function E(){for(const e of I.value)d.value.find(o=>o.id===e.id)||L(e.id)}let u=null;function j(e,o=null){let a=o;if(!a)try{a=JSON.parse(localStorage.getItem("game_settings")||"{}").voiceType||"us"}catch{a="us"}u&&(u.pause(),u=null);const t=e.toLowerCase().trim();if(!t)return;const n=`/data/audio/${a}/${t}.mp3`;try{u=new Audio(n),u.volume=1,u.play().catch(r=>{console.warn("æœ¬åœ°éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œå°è¯•åœ¨çº¿API:",r),U(t,a)}),u.onended=()=>{u=null}}catch(r){console.warn("åˆ›å»ºéŸ³é¢‘å¤±è´¥:",r),U(t,a)}}function U(e,o="us"){try{const a=o==="uk"?1:2,t=`https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(e)}&type=${a}`;u=new Audio(t),u.volume=1,u.play().catch(n=>{console.warn("åœ¨çº¿å‘éŸ³ä¹Ÿå¤±è´¥:",n),O(e)}),u.onended=()=>{u=null}}catch{O(e)}}function O(e){if("speechSynthesis"in window){const o=new SpeechSynthesisUtterance(e);o.lang="en-US",o.rate=.8,window.speechSynthesis.speak(o)}}function A(e=null){w.value&&clearInterval(w.value),e!==null?f.value=e:v.value!=="timed"&&v.value!=="pk"&&(f.value=0),k.value=!0,w.value=setInterval(()=>{v.value==="timed"||v.value==="pk"?(f.value--,f.value<=0&&G()):f.value++},1e3)}function G(){w.value&&(clearInterval(w.value),w.value=null),k.value=!1}function ee(){G(),c.value=null,m.value={},d.value=[],p.value=0,f.value=0}async function oe(){if(v.value==="campaign"){D(y.value);const e=y.value+1;y.value=e,localStorage.setItem(`campaign_level_${h.value}`,e.toString()),await C("campaign",e,h.value),E(),A(0)}else await C(v.value,0,h.value),A()}function D(e,o=null){var J;const t=`campaign_progress_${h.value}`;let n={unlocked:1,completed:{}};const r=localStorage.getItem(t);if(r)try{n=JSON.parse(r)}catch{}let s=o;if(s===null){const P=f.value;P<=120?s=3:P<=180?s=2:s=1}const l=((J=n.completed[e])==null?void 0:J.stars)||0;s>l?n.completed[e]={stars:s,score:p.value,time:f.value}:n.completed[e]||(n.completed[e]={stars:s,score:p.value,time:f.value}),e>=n.unlocked&&e<500&&(n.unlocked=e+1),localStorage.setItem(t,JSON.stringify(n))}return{currentGroup:h,currentMode:v,currentLevel:y,puzzle:c,userAnswers:m,prefilledCells:_,completedWords:d,score:p,timer:f,isPlaying:k,groups:K,cachedLevels:$,gridSize:M,words:I,cells:R,clueNumbers:H,progress:N,isLevelComplete:B,formattedTimer:q,loadPuzzle:C,loadGroupLevels:Q,loadSingleLevel:b,preloadNearbyLevels:T,getGroupLevelCount:W,setAnswer:Y,getAnswer:x,checkWord:L,checkAllWords:E,speakWord:j,startTimer:A,stopTimer:G,resetGame:ee,nextLevel:oe,isPrefilledCell:X,saveLevelProgress:D}});export{se as u};
