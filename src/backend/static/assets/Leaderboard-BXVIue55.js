import{_ as Z,l as ee,o as se,a as o,c as l,b as e,e as ae,w as te,F as g,r as k,n as b,t as n,f as h,v as W,j as oe,h as u,i as le,p as ne}from"./index-DYfv8LOO.js";const ce={class:"leaderboard-screen"},ie={class:"main-card"},de={class:"nav-row"},re={class:"selection-section"},ue={class:"type-grid"},_e=["onClick"],ve={class:"type-icon"},me={class:"type-name"},pe={class:"selection-section"},ge={class:"group-tabs"},ke=["onClick"],be={key:0,class:"subgroup-row"},he=["onClick"],fe={class:"leaderboard-section"},ye={key:0,class:"loading-state"},we={key:1,class:"empty-state"},xe={key:2,class:"leaderboard-list"},Ce={class:"rank-col"},Se={key:0,class:"rank-medal"},Le={key:1,class:"rank-num"},We={class:"user-col"},$e={class:"user-avatar"},je={class:"user-info"},Ie={class:"user-name"},Ee={class:"user-group"},Te={class:"value-col"},Ge={class:"value-main"},Ne={class:"value-label"},Pe={key:0,class:"value-extra"},Ve={key:0},Ke={key:1},Oe={class:"action-row"},Re=["disabled"],Be={class:"my-stats-card"},Me={class:"stats-grid"},Ae={class:"stat-item purple"},Fe={class:"stat-value"},ze={class:"stat-item green"},Je={class:"stat-value"},De={class:"stat-item orange"},Ue={class:"stat-value"},qe={class:"stat-item blue"},He={class:"stat-value"},Qe={key:0,class:"my-rankings"},Xe={class:"rankings-list"},Ye={class:"ranking-type"},Ze={key:0,class:"ranking-rank"},es={key:1,class:"ranking-rank"},ss={__name:"Leaderboard",setup(as){const x="",f=u(!1),m=u("campaign_level"),r=u("all"),_=u(null),y=u([]),C=u(null),B=u([{code:"campaign_level",name:"é—¯å…³å…³å¡æ¦œ"},{code:"campaign_score",name:"é—¯å…³ç§¯åˆ†æ¦œ"},{code:"endless_level",name:"æ— é™å…³å¡æ¦œ"},{code:"endless_score",name:"æ— é™ç§¯åˆ†æ¦œ"},{code:"timed_words",name:"è®¡æ—¶å•è¯æ¦œ"},{code:"timed_score",name:"è®¡æ—¶ç§¯åˆ†æ¦œ"},{code:"pk_wins",name:"PKè·èƒœæ¦œ"},{code:"pk_score",name:"PKç§¯åˆ†æ¦œ"}]),M=[{code:"primary",name:"å°å­¦"},{code:"middle",name:"åˆé«˜ä¸­"},{code:"exam",name:"è€ƒè¯•"}],$={primary:[{code:"grade3_1",name:"ä¸‰ä¸Š"},{code:"grade3_2",name:"ä¸‰ä¸‹"},{code:"grade4_1",name:"å››ä¸Š"},{code:"grade4_2",name:"å››ä¸‹"},{code:"grade5_1",name:"äº”ä¸Š"},{code:"grade5_2",name:"äº”ä¸‹"},{code:"grade6_1",name:"å…­ä¸Š"},{code:"grade6_2",name:"å…­ä¸‹"}],middle:[{code:"junior",name:"åˆä¸­"},{code:"senior",name:"é«˜ä¸­"}],exam:[{code:"ket",name:"KET"},{code:"pet",name:"PET"},{code:"cet4",name:"å››çº§"},{code:"cet6",name:"å…­çº§"},{code:"postgrad",name:"è€ƒç ”"},{code:"ielts",name:"é›…æ€"},{code:"toefl",name:"æ‰˜ç¦"},{code:"gre",name:"GRE"}]},j=le(()=>_.value?$[_.value]||[]:[]);function A(t){return{campaign_level:"ğŸ°",campaign_score:"â­",endless_level:"â™¾ï¸",endless_score:"ğŸŒŸ",timed_words:"â±ï¸",timed_score:"ğŸ’«",pk_wins:"âš”ï¸",pk_score:"ğŸ…"}[t]||"ğŸ“Š"}function F(){return{campaign_level:"å…³",campaign_score:"åˆ†",endless_level:"å…³",endless_score:"åˆ†",timed_words:"è¯",timed_score:"åˆ†",pk_wins:"èƒœ",pk_score:"åˆ†"}[m.value]||""}function z(t){return t>=1e4?(t/1e4).toFixed(1)+"ä¸‡":t}const i=u({campaignLevel:1,totalScore:0,totalWords:0,pkWins:0,endlessLevel:0,timedWords:0,playCount:0});async function S(){f.value=!0;try{const t=await W.get(`${x}/api/leaderboard/${m.value}`,{params:{group:r.value,limit:50}});y.value=t.data.entries||[]}catch(t){console.error("åŠ è½½æ’è¡Œæ¦œå¤±è´¥:",t),y.value=[]}finally{f.value=!1}}async function J(){try{const t=D();if(!t)return;const a=await W.get(`${x}/api/leaderboard/user/${t}`);C.value=a.data.rankings}catch(t){console.error("åŠ è½½æˆ‘çš„æ’åå¤±è´¥:",t)}}function D(){const t=document.cookie.match(/user_id=([^;]+)/);return t?t[1]:null}function U(t){return t===1?"rank-gold":t===2?"rank-silver":t===3?"rank-bronze":""}function q(t){return{1:"ğŸ¥‡",2:"ğŸ¥ˆ",3:"ğŸ¥‰"}[t]||""}function H(t){m.value=t}function Q(t){if(_.value===t)_.value=null,r.value="all";else{_.value=t;const a=$[t];a&&a.length>0&&(r.value=a[0].code)}}async function X(){var t,a,w,s,v,I,E,T,G,N,P,V,K;try{const d=await W.get(`${x}/api/user/stats`,{withCredentials:!0});if(d.data.registered&&d.data.stats){const c=d.data.stats;i.value.campaignLevel=((t=c.campaign)==null?void 0:t.max_level)||1,i.value.totalScore=(((a=c.campaign)==null?void 0:a.total_score)||0)+(((w=c.endless)==null?void 0:w.total_score)||0)+(((s=c.timed)==null?void 0:s.total_score)||0)+(((v=c.pk)==null?void 0:v.total_score)||0),i.value.totalWords=((I=c.campaign)==null?void 0:I.total_words)||0,i.value.pkWins=((E=c.pk)==null?void 0:E.wins)||0,i.value.endlessLevel=((T=c.endless)==null?void 0:T.max_level)||0,i.value.timedWords=((G=c.timed)==null?void 0:G.max_words)||0,i.value.playCount=(((N=c.campaign)==null?void 0:N.play_count)||0)+(((P=c.endless)==null?void 0:P.play_count)||0)+(((V=c.timed)==null?void 0:V.play_count)||0)+(((K=c.pk)==null?void 0:K.play_count)||0);return}}catch(d){console.log("APIç»Ÿè®¡è·å–å¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°å­˜å‚¨:",d)}try{const d=Object.keys(localStorage).filter(p=>p.startsWith("campaign_progress_"));let c=1,O=0;d.forEach(p=>{const L=JSON.parse(localStorage.getItem(p)||"{}"),Y=Object.keys(L.completed||{}).length;O+=Y,L.unlocked>c&&(c=L.unlocked)}),i.value.campaignLevel=c,i.value.totalWords=O*5,i.value.totalScore=i.value.totalWords*10;const R=localStorage.getItem("pk_stats");if(R){const p=JSON.parse(R);i.value.pkWins=p.wins||0}}catch(d){console.error("åŠ è½½ç»Ÿè®¡å¤±è´¥:",d)}}return ee([m,r],()=>{S()}),se(()=>{S(),X(),J()}),(t,a)=>{const w=oe("router-link");return o(),l("div",ce,[a[12]||(a[12]=e("div",{class:"header-section"},[e("div",{class:"logo-area"},[e("h1",{class:"title"},"ğŸ† æ’è¡Œæ¦œ")]),e("p",{class:"subtitle"},"çœ‹çœ‹è°æ˜¯å•è¯è¾¾äººï¼")],-1)),e("div",ie,[e("div",de,[ae(w,{to:"/",class:"back-btn"},{default:te(()=>[...a[1]||(a[1]=[ne("â† è¿”å›é¦–é¡µ",-1)])]),_:1})]),e("div",re,[a[2]||(a[2]=e("h3",{class:"section-label"},"ğŸ“Š æ¦œå•ç±»å‹",-1)),e("div",ue,[(o(!0),l(g,null,k(B.value,s=>(o(),l("button",{key:s.code,onClick:v=>H(s.code),class:b(["type-btn",{active:m.value===s.code}])},[e("span",ve,n(A(s.code)),1),e("span",me,n(s.name),1)],10,_e))),128))])]),e("div",pe,[a[3]||(a[3]=e("h3",{class:"section-label"},"ğŸ“š è¯åº“åˆ†ç»„",-1)),e("div",ge,[e("button",{onClick:a[0]||(a[0]=s=>r.value="all"),class:b(["group-tab",{active:r.value==="all"}])}," å…¨éƒ¨ ",2),(o(),l(g,null,k(M,s=>e("button",{key:s.code,onClick:v=>Q(s.code),class:b(["group-tab",{active:_.value===s.code}])},n(s.name),11,ke)),64))]),_.value&&j.value.length>0?(o(),l("div",be,[(o(!0),l(g,null,k(j.value,s=>(o(),l("button",{key:s.code,onClick:v=>r.value=s.code,class:b(["subgroup-btn",{active:r.value===s.code}])},n(s.name),11,he))),128))])):h("",!0)]),e("div",fe,[f.value?(o(),l("div",ye,[...a[4]||(a[4]=[e("div",{class:"loading-spinner"},"â³",-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):y.value.length===0?(o(),l("div",we,[...a[5]||(a[5]=[e("div",{class:"empty-icon"},"ğŸ“­",-1),e("p",{class:"empty-text"},"æš‚æ— æ’è¡Œæ•°æ®",-1),e("p",{class:"empty-hint"},"å¿«å»ç©æ¸¸æˆï¼Œæˆä¸ºç¬¬ä¸€åå§ï¼",-1)])])):(o(),l("div",xe,[(o(!0),l(g,null,k(y.value,s=>(o(),l("div",{key:s.user_id+s.rank,class:b(["leaderboard-row",U(s.rank)])},[e("div",Ce,[s.rank<=3?(o(),l("span",Se,n(q(s.rank)),1)):(o(),l("span",Le,n(s.rank),1))]),e("div",We,[e("span",$e,n(s.avatar),1),e("div",je,[e("div",Ie,n(s.nickname),1),e("div",Ee,n(s.group_name),1)])]),e("div",Te,[e("div",Ge,n(z(s.value)),1),e("div",Ne,n(F()),1),s.extra&&Object.keys(s.extra).length>0?(o(),l("div",Pe,[s.extra.wins!==void 0?(o(),l("span",Ve,n(s.extra.wins)+"èƒœ",1)):h("",!0),s.extra.games!==void 0?(o(),l("span",Ke,"/"+n(s.extra.games)+"åœº",1)):h("",!0)])):h("",!0)])],2))),128))]))]),e("div",Oe,[e("button",{onClick:S,disabled:f.value,class:"refresh-btn"}," ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ ",8,Re)])]),e("div",Be,[a[11]||(a[11]=e("h3",{class:"stats-title"},"ğŸ“Š æˆ‘çš„è®°å½•",-1)),e("div",Me,[e("div",Ae,[e("div",Fe,n(i.value.campaignLevel),1),a[6]||(a[6]=e("div",{class:"stat-label"},"é—¯å…³è¿›åº¦",-1))]),e("div",ze,[e("div",Je,n(i.value.totalScore),1),a[7]||(a[7]=e("div",{class:"stat-label"},"æ€»ç§¯åˆ†",-1))]),e("div",De,[e("div",Ue,n(i.value.totalWords),1),a[8]||(a[8]=e("div",{class:"stat-label"},"å®Œæˆå•è¯",-1))]),e("div",qe,[e("div",He,n(i.value.pkWins),1),a[9]||(a[9]=e("div",{class:"stat-label"},"PKèƒœåœº",-1))])]),C.value?(o(),l("div",Qe,[a[10]||(a[10]=e("h4",{class:"rankings-title"},"æˆ‘çš„æ’å",-1)),e("div",Xe,[(o(!0),l(g,null,k(C.value,(s,v)=>(o(),l("div",{key:v,class:"ranking-item"},[e("span",Ye,n(s.name),1),s.groups&&s.groups.all?(o(),l("span",Ze," ç¬¬"+n(s.groups.all.rank)+"å / "+n(s.groups.all.total)+"äºº ",1)):(o(),l("span",es,"æš‚æ— "))]))),128))])])):h("",!0)]),a[13]||(a[13]=e("div",{class:"footer-decoration"},[e("span",{class:"footer-icon"},"ğŸ¥‡"),e("span",{class:"footer-icon"},"ğŸ¥ˆ"),e("span",{class:"footer-icon"},"ğŸ¥‰")],-1))])}}},os=Z(ss,[["__scopeId","data-v-71a8b053"]]);export{os as default};
