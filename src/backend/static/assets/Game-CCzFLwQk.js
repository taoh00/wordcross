import{_ as ft,u as pt,l as gt,o as _t,m as ht,a as d,c as v,b as o,t as i,p as yt,g as y,f as A,n as L,q as ke,F as E,r as R,s as le,v as j,h as _,x as wt,i as B,y as be,k as kt}from"./index-DYfv8LOO.js";import{u as bt}from"./game-BMruQe6J.js";import{u as Ct}from"./settings-B6p1neAb.js";let Q=null,b=null,ce=null,ue=[],Ce=null;function J(){return Q||(Q=new(window.AudioContext||window.webkitAudioContext)),Q.state==="suspended"&&Q.resume(),Q}function X(){try{return JSON.parse(localStorage.getItem("game_settings")||"{}")}catch{return{}}}function Tt(){const f=X();if(f.soundEffect!==!1)try{const r=J(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.setValueAtTime(800,r.currentTime),c.frequency.exponentialRampToValueAtTime(600,r.currentTime+.05),p.gain.setValueAtTime(.15,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.05),c.start(r.currentTime),c.stop(r.currentTime+.05),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate(10)}catch{}}function St(){if(X().soundEffect!==!1)try{const r=J(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.setValueAtTime(400,r.currentTime),c.frequency.exponentialRampToValueAtTime(200,r.currentTime+.08),p.gain.setValueAtTime(.12,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.08),c.start(r.currentTime),c.stop(r.currentTime+.08)}catch{}}function At(){const f=X();if(f.soundEffect!==!1)try{const r=J(),c=r.createOscillator(),p=r.createGain();c.connect(p),p.connect(r.destination),c.type="sine",c.frequency.value=523.25,p.gain.setValueAtTime(.2,r.currentTime),p.gain.exponentialRampToValueAtTime(.01,r.currentTime+.15),c.start(r.currentTime),c.stop(r.currentTime+.15);const s=r.createOscillator(),x=r.createGain();s.connect(x),x.connect(r.destination),s.type="sine",s.frequency.value=659.25,x.gain.setValueAtTime(.2,r.currentTime+.1),x.gain.exponentialRampToValueAtTime(.01,r.currentTime+.25),s.start(r.currentTime+.1),s.stop(r.currentTime+.25),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate([30,50,30])}catch{}}function Lt(){const f=X();if(f.soundEffect!==!1)try{const r=J();r.state==="suspended"?r.resume().then(()=>{Ve(r)}):Ve(r),f.vibration!==!1&&navigator.vibrate&&navigator.vibrate([50,50,50,50,100])}catch(r){console.warn("é€šå…³éŸ³æ•ˆæ’­æ”¾å¤±è´¥:",r)}}function Ve(f){[{freq:523.25,time:0},{freq:659.25,time:.15},{freq:783.99,time:.3},{freq:1046.5,time:.45}].forEach(c=>{const p=f.createOscillator(),s=f.createGain();p.connect(s),s.connect(f.destination),p.type="sine",p.frequency.value=c.freq,s.gain.setValueAtTime(.35,f.currentTime+c.time),s.gain.exponentialRampToValueAtTime(.01,f.currentTime+c.time+.3),p.start(f.currentTime+c.time),p.stop(f.currentTime+c.time+.3)})}function xt(f="campaign"){if(X().bgMusic!==!1)try{let ve=function(M){let w=M;return s.forEach(({note:z,duration:P})=>{const F=x[z];if(!F||!b)return;const V=c.createOscillator(),G=c.createOscillator(),m=c.createGain();V.type="sine",V.frequency.value=F,G.type="triangle",G.frequency.value=F*2;const h=c.createGain();h.gain.value=f==="timed"||f==="pk"?.2:.15,V.connect(m),G.connect(h),h.connect(m),m.connect(b),m.gain.setValueAtTime(0,w),m.gain.linearRampToValueAtTime(.5,w+.05),m.gain.linearRampToValueAtTime(.3,w+P*.5),m.gain.linearRampToValueAtTime(0,w+P-.02),V.start(w),V.stop(w+P),G.start(w),G.stop(w+P),ue.push({osc:V,stopTime:w+P}),ue.push({osc:G,stopTime:w+P}),w+=P}),w},C=function(){if(!b)return;const M=c.currentTime+.1;ve(M),ce=setTimeout(C,(de-.3)*1e3)};const c=J();if(Ce===f&&b)return;$e(),Ce=f,ue=[],b=c.createGain(),b.gain.value=0,b.connect(c.destination),b.gain.linearRampToValueAtTime(.08,c.currentTime+.5);let s,x,u;f==="timed"||f==="pk"?(u=.35,s=[{note:"E4",duration:u},{note:"G4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"D4",duration:u},{note:"E4",duration:u*2},{note:"G4",duration:u},{note:"A4",duration:u},{note:"B4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"D4",duration:u*2}],x={D4:293.66,E4:329.63,G4:392,A4:440,B4:493.88}):(u=.8,s=[{note:"C4",duration:u},{note:"E4",duration:u},{note:"G4",duration:u},{note:"E4",duration:u},{note:"F4",duration:u},{note:"A4",duration:u},{note:"G4",duration:u*1.5},{note:"E4",duration:u*.5},{note:"D4",duration:u},{note:"F4",duration:u},{note:"E4",duration:u},{note:"C4",duration:u},{note:"D4",duration:u},{note:"G3",duration:u},{note:"C4",duration:u*2}],x={G3:196,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440});const de=s.reduce((M,w)=>M+w.duration,0);C()}catch(c){console.warn("èƒŒæ™¯éŸ³ä¹å¯åŠ¨å¤±è´¥:",c)}}function $e(){if(ce&&(clearTimeout(ce),ce=null),Ce=null,b){try{const r=J().currentTime;b.gain.cancelScheduledValues(r),b.gain.setValueAtTime(b.gain.value,r),b.gain.linearRampToValueAtTime(0,r+.1);const c=b;setTimeout(()=>{try{c.disconnect()}catch{}},150)}catch{try{b.disconnect()}catch{}}b=null}ue=[]}const Et={class:"game-screen"},Gt={class:"top-bar"},Nt={class:"game-card-compact"},It={class:"top-row-1"},Pt={class:"user-info-mini"},Wt={class:"mini-avatar"},Ot={class:"mini-name"},Rt={class:"mini-stats"},Vt={class:"mini-stat",title:"ä½“åŠ›"},$t={class:"mini-stat",title:"æç¤º"},Bt={class:"mini-stat",title:"å‘éŸ³"},Mt={class:"top-row-2"},Dt={class:"game-mode-badge"},qt={key:0,class:"level-badge"},Ut={class:"score-mini"},jt={class:"progress-mini"},Jt={class:"progress-bar-mini"},zt={class:"progress-text-mini"},Ft={class:"main-content"},Kt={class:"game-card-main"},Yt={class:"flex justify-center"},Ht=["onClick"],Qt={key:0,class:"clue-number"},Xt={key:1,class:"cell-letter"},Zt={class:"words-section"},en={class:"words-list"},tn=["onClick"],nn={class:"word-index"},sn={class:"word-direction-badge"},an=["onClick"],on={key:0,class:"word-definition"},rn=["onClick"],ln=["onClick"],cn={class:"word-placeholder"},un={key:0,class:"word-translation-hint"},dn={class:"keyboard-section"},vn={class:"keyboard-wrapper"},mn={class:"keyboard-container"},fn={class:"keyboard-row"},pn=["onClick"],gn={class:"keyboard-row"},_n=["onClick"],hn={class:"keyboard-row"},yn=["onClick"],wn=["disabled"],kn={class:"prop-num"},bn=["disabled"],Cn={class:"prop-num"},Tn={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Sn={class:"complete-modal animate-bounce-in"},An={class:"confetti-container"},Ln={class:"trophy-area"},xn={class:"trophy-emoji"},En={class:"stars-row"},Gn={class:"stars-hint"},Nn={class:"complete-title"},In={class:"stats-inline"},Pn={key:0,class:"reward-display"},Wn={class:"reward-items"},On={class:"reward-icon"},Rn={class:"reward-value"},Vn={class:"reward-name"},$n={key:1,class:"all-complete-msg"},Bn={class:"modal-btns three-btns"},Mn=["disabled"],Dn={class:"word-detail-card animate-bounce-in"},qn={class:"detail-word"},Un={key:0,class:"detail-phonetic"},jn={class:"detail-speak-btns"},Jn={class:"detail-section"},zn={class:"detail-content"},Fn={key:1,class:"detail-section"},Kn={class:"detail-content example"},Yn={class:"detail-meta"},Hn={class:"meta-badge"},Qn={class:"meta-badge"},Xn={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Zn={class:"energy-modal animate-bounce-in"},es={class:"energy-modal-info"},ts={class:"energy-current"},ns={class:"energy-need"},ss={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},as={__name:"Game",setup(f,{expose:r}){const c=wt(),p=kt(),s=bt(),x=Ct(),u=pt(),de=B(()=>u.avatar||"ğŸ˜Š"),ve=B(()=>u.nickname||"æ¸¸å®¢"),C=_(100),M={campaign:5,timed:15,pk:15,endless:30};function w(){try{const e=localStorage.getItem("user_energy");if(e){const t=JSON.parse(e);C.value=t.value??100}}catch{C.value=100}}async function z(e){C.value=e;try{const t=new Date().toISOString().split("T")[0],n={value:e,date:t};localStorage.setItem("user_energy",JSON.stringify(n))}catch(t){console.error("ä¿å­˜ä½“åŠ›å¤±è´¥:",t)}try{await fetch("/api/user/energy",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({energy:e})})}catch(t){console.error("åŒæ­¥ä½“åŠ›åˆ°åç«¯å¤±è´¥:",t)}}async function P(e){const t=M[e]||5;if(C.value<t)return fe.value={required:t,current:C.value},ee.value=!0,!1;const n=C.value-t;await z(n);try{await fetch(`/api/user/energy/consume?mode=${e}`,{method:"POST"})}catch(a){console.error("åç«¯è®°å½•ä½“åŠ›æ¶ˆè€—å¤±è´¥:",a)}return!0}function F(){ee.value=!1,p.push("/home")}async function V(){try{const a=await fetch("/api/user/energy/claim-free",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:10})});if(a.ok){const l=await a.json();C.value=l.energy,localStorage.setItem("user_energy",JSON.stringify({value:l.energy,date:new Date().toISOString().split("T")[0]}))}else{const l=C.value+10;await z(l)}}catch(a){console.error("é¢†å–ä½“åŠ›å¤±è´¥:",a);const l=C.value+10;await z(l)}ee.value=!1;const t=s.currentMode||"campaign";await P(t)&&await initGame()}const G=_(!0),m=_(null),h=_(0),k=_(0),Z=_(!1),Te=_({}),me=_(!1),S=_(null),ee=_(!1),fe=_({required:5,current:0}),te=_(!1),K=_(!1),N=_(20),I=_(20),pe=_(null),Y=_(0),Be=B(()=>({campaign:"ğŸ°",endless:"â™¾ï¸",timed:"â±ï¸",pk:"âš”ï¸"})[s.currentMode]||"ğŸ®"),Me=B(()=>({campaign:"é—¯å…³",endless:"æ— é™",timed:"è®¡æ—¶",pk:"PK"})[s.currentMode]||"æ¸¸æˆ"),De=B(()=>s.currentMode==="timed"||s.currentMode==="pk"?s.timer<60:!1),ge=B(()=>!s.words||s.words.length===0?[]:[...s.words].sort((e,t)=>{const n=e.clue_number||999,a=t.clue_number||999;return n!==a?n-a:e.direction!==t.direction?e.direction==="across"?-1:1:0})),$=B(()=>{const e=s.timer;return e<=120?3:e<=180?2:1}),ne=_(180),se=B(()=>s.currentMode==="campaign"&&s.currentLevel>=ne.value),ae=_(!1),W=_(!1),D=_([]);async function qe(){try{const t=await j.post("/api/game/generate-reward",{},{withCredentials:!0});if(t.data.success)return t.data.rewards}catch(e){console.error("è·å–å¥–åŠ±å¤±è´¥:",e)}return[{type:"energy",name:"ä½“åŠ›",icon:"âš¡",value:5},{type:"hint",name:"æç¤º",icon:"ğŸ’¡",value:1}]}async function Ue(){if(!W.value&&D.value.length!==0)try{const t=await j.post("/api/game/claim-reward",{level:s.currentLevel,vocab_group:s.vocabGroup,stars:levelStars.value,time_seconds:s.timer},{withCredentials:!0});if(t.data.success){D.value=t.data.rewards;const n=t.data.updated_data;n&&(C.value=n.energy,n.props&&(N.value=n.props.hintLetterCount,I.value=n.props.showTranslationCount)),await Ke(s.score),W.value=!0}}catch(e){console.error("é¢†å–å¥–åŠ±å¤±è´¥:",e),W.value=!0}}async function je(){Z.value=!1,ae.value=!1,W.value=!1,D.value=[],Ae(),s.nextLevel(),be(()=>{_e()})}function _e(){const e=ge.value.filter(t=>!q(t.id));e.length>0&&re(e[0])}function he(e){var n;return!te.value||!m.value||m.value.id!==pe.value?!1:(((n=m.value.word)==null?void 0:n.toUpperCase())||"").includes(e)}function Je(){N.value<=0||m.value&&(te.value=!0,pe.value=m.value.id,N.value--,oe())}function ze(){if(I.value<=0||!m.value||K.value)return;K.value=!0,I.value--,oe();const e=m.value.word;Y.value=0,Se(e,3)}function Se(e,t){if(Y.value>=t){K.value=!1,Y.value=0;return}Y.value++,s.speakWord(e),setTimeout(()=>{Se(e,t)},1200)}function Fe(){try{const e=localStorage.getItem("game_props");if(e){const t=JSON.parse(e);N.value=t.hintLetterCount??20,I.value=t.speakPropCount??20}else N.value=20,I.value=20,oe()}catch{N.value=20,I.value=20}}function oe(){try{const e={hintLetterCount:N.value,speakPropCount:I.value};localStorage.setItem("game_props",JSON.stringify(e))}catch{}}async function Ke(e){try{await fetch("/api/game/score",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({score:e,vocab_group:s.currentGroup,level:s.currentLevel})}),console.log("ç§¯åˆ†åŒæ­¥æˆåŠŸ")}catch(t){console.error("åŒæ­¥ç§¯åˆ†åˆ°åç«¯å¤±è´¥:",t)}}async function Ye(){try{const e=await fetch("/api/user/energy",{credentials:"include"});if(e.ok){const n=await e.json();n.energy!==void 0&&(C.value=n.energy,localStorage.setItem("user_energy",JSON.stringify({value:n.energy,date:new Date().toISOString().split("T")[0]})))}const t=await fetch("/api/user/props",{credentials:"include"});if(t.ok){const n=await t.json();n.hintLetterCount!==void 0&&(N.value=n.hintLetterCount,I.value=n.showTranslationCount||20,oe())}}catch(e){console.warn("ä»åç«¯åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:",e)}}function Ae(){te.value=!1,K.value=!1,pe.value=null,Y.value=0}function He(e){const t=e.length,n=[];for(let a=0;a<t;a++){let l=e.start_row,T=e.start_col;e.direction==="across"?T+=a:l+=a;const g=s.getAnswer(l,T);g?n.push(g):n.push("_")}return n}function Le(e,t){const n=s.clueNumbers;return!n||!n[e]?null:n[e][t]}function Qe(e,t,n){const a=["letter-cell-new"];if(n===null)return a.push("empty"),a.join(" ");const l=s.isPrefilledCell(e,t);return Xe(e,t)?a.push("locked"):l?a.push("prefilled"):Ze(e,t)?a.push("active"):et(e,t)&&a.push("in-word"),a.join(" ")}function Xe(e,t){for(const n of s.completedWords)if(n.direction==="across"){if(e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length)return!0}else if(t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length)return!0;return!1}function Ze(e,t){return e===h.value&&t===k.value}function et(e,t){if(!m.value)return!1;const n=m.value;return n.direction==="across"?e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length:t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length}function O(e,t){return!!s.isPrefilledCell(e,t)}function q(e){return s.completedWords.some(t=>t.id===e)}function xe(e){return s.completedWords.find(n=>n.id===e)||{}}function tt(e,t,n){n!==null&&(O(e,t)||(h.value=e,k.value=t,nt(e,t)))}function nt(e,t){for(const n of s.words)if(n.direction==="across"&&e===n.start_row&&t>=n.start_col&&t<n.start_col+n.length){m.value=n;return}for(const n of s.words)if(n.direction==="down"&&t===n.start_col&&e>=n.start_row&&e<n.start_row+n.length){m.value=n;return}}function re(e){m.value=e,be(()=>{const t=Te.value[e.id];t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})});for(let t=0;t<e.length;t++){let n=e.start_row,a=e.start_col;if(e.direction==="across"?a+=t:n+=t,!O(n,a)){h.value=n,k.value=a;return}}h.value=e.start_row,k.value=e.start_col}function ye(e){O(h.value,k.value)||(s.setAnswer(h.value,k.value,e),ie("type"),ot(h.value,k.value),at())}function st(){if(O(h.value,k.value)){Ee();return}ie("delete"),s.getAnswer(h.value,k.value)?s.setAnswer(h.value,k.value,""):(Ee(),O(h.value,k.value)||s.setAnswer(h.value,k.value,""))}function at(){if(!m.value)return;const e=m.value;if(e.direction==="across"){let t=k.value+1;for(;t<e.start_col+e.length&&O(e.start_row,t);)t++;t<e.start_col+e.length?k.value=t:Ge()}else{let t=h.value+1;for(;t<e.start_row+e.length&&O(t,e.start_col);)t++;t<e.start_row+e.length?h.value=t:Ge()}}function Ee(){if(!m.value)return;const e=m.value;if(e.direction==="across"){let t=k.value-1;for(;t>=e.start_col&&O(e.start_row,t);)t--;t>=e.start_col&&(k.value=t)}else{let t=h.value-1;for(;t>=e.start_row&&O(t,e.start_col);)t--;t>=e.start_row&&(h.value=t)}}function Ge(){const e=ge.value.filter(t=>!q(t.id));if(e.length>0){const n=(e.findIndex(a=>{var l;return a.id===((l=m.value)==null?void 0:l.id)})+1)%e.length;re(e[n])}}function ot(e,t){let n=!1,a=[];for(const l of s.words){if(q(l.id))continue;s.checkWord(l.id)&&(n=!0,a.push(l.id))}n&&(ie("correct"),m.value&&a.includes(m.value.id)&&be(()=>{_e()}))}function we(e,t=null){s.speakWord(e,t)}function Ne(e){S.value=e,me.value=!0}function Ie(){me.value=!1,S.value=null}function ie(e){switch(e){case"type":Tt();break;case"correct":At();break;case"delete":St();break;case"levelComplete":Lt();break}}function Pe(){s.resetGame(),p.push("/")}function rt(){Z.value=!1,s.loadPuzzle("campaign",s.currentLevel,s.currentGroup),s.startTimer(),s.words.length>0&&re(s.words[0])}gt(()=>s.isLevelComplete,async e=>{if(e){s.stopTimer(),ie("levelComplete");const t=s.completedWords.length,n=t*10;await ut(s.currentMode,t,n),s.currentMode==="campaign"?(s.saveLevelProgress(s.currentLevel),await U("campaign_level",s.currentLevel),await U("campaign_score",n)):s.currentMode==="endless"?(it(),await U("endless_level",H.value),await U("endless_score",n)):s.currentMode==="timed"&&(await U("timed_words",t),await U("timed_score",n)),dt(t,n),D.value=await qe(),ae.value=!0,W.value=!1,setTimeout(()=>{Z.value=!0},500)}});const H=_(1);function it(){H.value++,localStorage.setItem("endless_level_count",H.value.toString())}function lt(){const e=localStorage.getItem("endless_level_count");e&&(H.value=parseInt(e)||1)}async function U(e,t){try{const n=We(),a=Oe();if(!n)return;await j.post(`/api/leaderboard/${e}/submit`,{user_id:n,nickname:a.nickname||"æ¸¸å®¢",avatar:a.avatar||"ğŸ˜Š",group:s.currentGroup,value:t,extra:{time:s.timer,level:s.currentLevel}}),console.log(`æ’è¡Œæ¦œæäº¤æˆåŠŸ: ${e} = ${t}`)}catch(n){console.error("æ’è¡Œæ¦œæäº¤å¤±è´¥:",n)}}async function ct(e){try{const t=We(),n=Oe();if(!t)return;const a="";await j.post(`${a}/api/game/pk-result`,{vocab_group:s.currentGroup,result:e,words_count:s.completedWords.length,duration_seconds:s.timer},{withCredentials:!0}),await j.post(`${a}/api/leaderboard/pk/submit`,{user_id:t,nickname:n.nickname||"æ¸¸å®¢",avatar:n.avatar||"ğŸ˜Š",group:s.currentGroup,result:e}),vt(e),console.log(`PKç»“æœæäº¤æˆåŠŸ: ${e}`)}catch(t){console.error("PKç»“æœæäº¤å¤±è´¥:",t)}}async function ut(e,t,n){try{const a="";let l=0;e==="campaign"?l=s.currentLevel:e==="endless"&&(l=H.value),await j.post(`${a}/api/game/submit`,{game_mode:e,vocab_group:s.currentGroup,score:n,words_count:t,level_reached:l,duration_seconds:s.timer,result:null,extra_data:{grid_size:s.gridSize,difficulty:s.currentDifficulty}},{withCredentials:!0}),console.log(`æ¸¸æˆæ•°æ®æäº¤æˆåŠŸ: ${e}, åˆ†æ•°=${n}`)}catch(a){console.error("æ¸¸æˆæ•°æ®æäº¤å¤±è´¥:",a)}}function We(){const e=document.cookie.match(/user_id=([^;]+)/);return e?e[1]:null}function Oe(){try{const e=localStorage.getItem("user_info");if(e)return JSON.parse(e)}catch{}return{nickname:"æ¸¸å®¢",avatar:"ğŸ˜Š"}}function dt(e,t){try{const n="myStats";let a={totalGames:0,totalWords:0,totalScore:0,highScore:0,campaignLevel:1};const l=localStorage.getItem(n);l&&(a=JSON.parse(l)),a.totalGames=(a.totalGames||0)+1,a.totalWords=(a.totalWords||0)+e,a.totalScore=(a.totalScore||0)+t,t>(a.highScore||0)&&(a.highScore=t),s.currentMode==="campaign"&&s.currentLevel>(a.campaignLevel||1)&&(a.campaignLevel=s.currentLevel),localStorage.setItem(n,JSON.stringify(a))}catch(n){console.error("ä¿å­˜ç»Ÿè®¡å¤±è´¥:",n)}}function vt(e){try{const t="pk_stats";let n={wins:0,draws:0,losses:0,games:0};const a=localStorage.getItem(t);a&&(n=JSON.parse(a)),n.games=(n.games||0)+1,e==="win"?n.wins=(n.wins||0)+1:e==="draw"?n.draws=(n.draws||0)+1:n.losses=(n.losses||0)+1,localStorage.setItem(t,JSON.stringify(n))}catch(t){console.error("ä¿å­˜PKç»Ÿè®¡å¤±è´¥:",t)}}r({submitPKResult:ct});async function mt(e){try{const t=await s.getGroupLevelCount(e);t>0?ne.value=t:ne.value=180}catch(t){console.warn("è·å–å…³å¡æ€»æ•°å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼",t),ne.value=180}}return _t(async()=>{G.value=!0,Fe(),w(),await Ye(),lt(),Ae(),ae.value=!1,W.value=!1,D.value=[];const e=c.params.mode,t=s.currentGroup||"primary";let n=1;if(!await P(e)){G.value=!1;return}if(x.bgMusic&&xt(e),e==="campaign"&&await mt(t),e==="campaign"){const g=localStorage.getItem(`campaign_level_${t}`);g&&(n=parseInt(g))}else if(e==="endless"){const g=localStorage.getItem("endless_level");g&&(n=parseInt(g))}const l=localStorage.getItem("game_difficulty")||"medium",T=e==="timed"?180:300;await s.loadPuzzle(e,n,t,T,l),G.value=!1,s.checkAllWords(),e==="timed"?s.startTimer(T):s.startTimer(0),_e()}),ht(()=>{s.stopTimer(),$e()}),(e,t)=>{var n;return d(),v("div",Et,[o("div",Gt,[o("div",Nt,[o("div",It,[o("button",{onClick:Pe,class:"back-btn-icon",title:"è¿”å›"}," â† "),o("div",Pt,[o("span",Wt,i(de.value),1),o("span",Ot,i(ve.value),1)]),o("div",Rt,[o("span",Vt,"âš¡"+i(C.value),1),o("span",$t,"ğŸ’¡"+i(N.value),1),o("span",Bt,"ğŸ”Š"+i(I.value),1)])]),o("div",Mt,[o("div",Dt,[yt(i(Be.value)+" "+i(Me.value)+" ",1),y(s).currentMode==="campaign"?(d(),v("span",qt," L"+i(y(s).currentLevel),1)):A("",!0)]),o("div",{class:L(["timer-mini",{warning:De.value}])}," â±ï¸"+i(y(s).formattedTimer),3),o("div",Ut,"ğŸŒŸ"+i(y(s).score),1),o("div",jt,[o("div",Jt,[o("div",{class:"progress-fill-mini",style:ke({width:y(s).progress+"%"})},null,4)]),o("span",zt,i(y(s).completedWords.length)+"/"+i(y(s).words.length),1)])])])]),o("div",Ft,[o("div",Kt,[o("div",Yt,[o("div",{class:"grid gap-1",style:ke({gridTemplateColumns:`repeat(${y(s).gridSize}, minmax(0, 1fr))`,maxWidth:`${y(s).gridSize*48}px`})},[(d(!0),v(E,null,R(y(s).cells,(a,l)=>(d(),v("div",{key:"row-"+l,class:"contents"},[(d(!0),v(E,null,R(a,(T,g)=>(d(),v("div",{key:`${l}-${g}`,class:L(Qe(l,g,T)),onClick:Re=>tt(l,g,T)},[Le(l,g)?(d(),v("span",Qt,i(Le(l,g)),1)):A("",!0),T!==null?(d(),v("span",Xt,i(y(s).getAnswer(l,g)),1)):A("",!0)],10,Ht))),128))]))),128))],4)])]),o("div",Zt,[o("div",en,[(d(!0),v(E,null,R(ge.value,(a,l)=>{var T;return d(),v("div",{key:a.id,ref_for:!0,ref:g=>{g&&(Te.value[a.id]=g)},class:L(["word-item",{completed:q(a.id),selected:((T=m.value)==null?void 0:T.id)===a.id}]),onClick:g=>!q(a.id)&&re(a)},[o("span",nn,i(a.clue_number||l+1),1),o("span",sn,i(a.direction==="across"?"æ¨ª":"ç«–"),1),q(a.id)?(d(),v(E,{key:0},[o("span",{class:"word-text",onClick:le(g=>Ne(xe(a.id)),["stop"])},i(a.word),9,an),y(x).showTranslation?(d(),v("span",on,i(a.definition),1)):A("",!0),o("button",{onClick:le(g=>Ne(xe(a.id)),["stop"]),class:"detail-btn",title:"æŸ¥çœ‹è¯¦æƒ…"}," ğŸ“– ",8,rn),o("button",{onClick:le(g=>we(a.word),["stop"]),class:"speak-btn",title:"å‘éŸ³"}," ğŸ”Š ",8,ln)],64)):(d(),v(E,{key:1},[o("span",cn,[(d(!0),v(E,null,R(He(a),(g,Re)=>(d(),v("span",{key:Re,class:L(["placeholder-char",{"hint-letter":g!=="_"}])},i(g),3))),128))]),y(x).showTranslation?(d(),v("span",un,i(a.definition),1)):A("",!0)],64))],10,tn)}),128))])])]),o("div",dn,[o("div",vn,[o("div",mn,[o("div",fn,[(d(),v(E,null,R("QWERTYUIOP",a=>o("button",{key:a,onClick:l=>ye(a),class:L(["keyboard-key-new",{"key-highlight":he(a)}])},i(a),11,pn)),64))]),o("div",gn,[(d(),v(E,null,R("ASDFGHJKL",a=>o("button",{key:a,onClick:l=>ye(a),class:L(["keyboard-key-new",{"key-highlight":he(a)}])},i(a),11,_n)),64)),o("button",{onClick:st,class:"keyboard-key-new delete-key"}," âŒ« ")]),o("div",hn,[(d(),v(E,null,R("ZXCVBNM",a=>o("button",{key:a,onClick:l=>ye(a),class:L(["keyboard-key-new",{"key-highlight":he(a)}])},i(a),11,yn)),64)),o("button",{onClick:Je,disabled:N.value<=0,class:L(["keyboard-prop-btn",{active:te.value}])},[t[2]||(t[2]=o("span",{class:"prop-emoji"},"ğŸ’¡",-1)),o("span",kn,i(N.value),1)],10,wn),o("button",{onClick:ze,disabled:I.value<=0||!m.value,class:L(["keyboard-prop-btn",{active:K.value}])},[t[3]||(t[3]=o("span",{class:"prop-emoji"},"ğŸ”Š",-1)),o("span",Cn,i(I.value),1)],10,bn)])])])]),Z.value?(d(),v("div",Tn,[o("div",Sn,[o("div",An,[(d(),v(E,null,R(12,a=>o("span",{key:a,class:"confetti",style:ke({"--delay":a*.1+"s","--x":Math.random()*200-100+"px"})},"ğŸŠ",4)),64))]),o("div",Ln,[o("div",xn,i(se.value?"ğŸ†":"ğŸ‰"),1),o("div",En,[o("span",{class:L(["star",{earned:$.value>=1}])},i($.value>=1?"â­":"â˜†"),3),o("span",{class:L(["star","big",{earned:$.value>=2}])},i($.value>=2?"â­":"â˜†"),3),o("span",{class:L(["star",{earned:$.value>=3}])},i($.value>=3?"â­":"â˜†"),3)]),o("div",Gn,i($.value===3?"å®Œç¾ï¼":$.value===2?"å¾ˆæ£’ï¼":"ç»§ç»­åŠ æ²¹ï¼"),1)]),o("h2",Nn,i(se.value?"æ­å–œå…¨éƒ¨é€šå…³ï¼":`ç¬¬${y(s).currentLevel}å…³ é€šå…³ï¼`),1),o("div",In," â±ï¸"+i(y(s).formattedTimer)+" Â· ğŸŒŸ"+i(y(s).score)+"åˆ† Â· ğŸ“"+i(y(s).completedWords.length)+"è¯ ",1),ae.value&&D.value.length>0?(d(),v("div",Pn,[t[4]||(t[4]=o("div",{class:"reward-title"},"ğŸ è·å¾—å¥–åŠ±",-1)),o("div",Wn,[(d(!0),v(E,null,R(D.value,(a,l)=>(d(),v("div",{key:l,class:"reward-item"},[o("span",On,i(a.icon),1),o("span",Rn,"+"+i(a.value),1),o("span",Vn,i(a.name),1)]))),128))])])):A("",!0),se.value?(d(),v("p",$n,"ğŸŒŸ å¤ªæ£’äº†ï¼ä½ å·²å®Œæˆå…¨éƒ¨å…³å¡ï¼")):A("",!0),o("div",Bn,[o("button",{onClick:Pe,class:"modal-btn secondary small"}," è¿”å› "),se.value?(d(),v("button",{key:1,onClick:rt,class:"modal-btn success small"}," å†ç©ä¸€æ¬¡ ")):(d(),v(E,{key:0},[o("button",{onClick:Ue,class:L(["modal-btn reward small",{claimed:W.value}]),disabled:W.value},i(W.value?"å·²é¢†å–":"é¢†å¥–"),11,Mn),o("button",{onClick:je,class:"modal-btn primary small"}," ä¸‹ä¸€å…³ ")],64))])])])):A("",!0),me.value&&S.value?(d(),v("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:le(Ie,["self"])},[o("div",Dn,[o("button",{onClick:Ie,class:"detail-close-btn"},"Ã—"),o("div",qn,i((n=S.value.word)==null?void 0:n.toUpperCase()),1),S.value.phonetic?(d(),v("div",Un,i(S.value.phonetic),1)):A("",!0),o("div",jn,[o("button",{onClick:t[0]||(t[0]=a=>we(S.value.word,"us")),class:"detail-speak-btn us"}," ğŸ”Š ç¾éŸ³ "),o("button",{onClick:t[1]||(t[1]=a=>we(S.value.word,"uk")),class:"detail-speak-btn uk"}," ğŸ”Š è‹±éŸ³ ")]),o("div",Jn,[t[5]||(t[5]=o("div",{class:"detail-label"},"ğŸ“– é‡Šä¹‰",-1)),o("div",zn,i(S.value.definition),1)]),S.value.example?(d(),v("div",Fn,[t[6]||(t[6]=o("div",{class:"detail-label"},"ğŸ“ ä¾‹å¥",-1)),o("div",Kn,i(S.value.example),1)])):A("",!0),o("div",Yn,[o("span",Hn,i(S.value.length)+" å­—æ¯",1),o("span",Qn,i(S.value.direction==="across"?"æ¨ªå‘ â†’":"çºµå‘ â†“"),1)])])])):A("",!0),ee.value?(d(),v("div",Xn,[o("div",Zn,[t[7]||(t[7]=o("div",{class:"energy-modal-icon"},"ğŸ˜´",-1)),t[8]||(t[8]=o("h3",{class:"energy-modal-title"},"ä½“åŠ›ä¸è¶³",-1)),t[9]||(t[9]=o("p",{class:"energy-modal-text"}," å½“å‰ä½“åŠ›ä¸è¶³ä»¥å¼€å§‹æ¸¸æˆ ",-1)),o("div",es,[o("span",ts,"å½“å‰ä½“åŠ›: âš¡"+i(fe.value.current),1),o("span",ns,"éœ€è¦: âš¡"+i(fe.value.required),1)]),o("div",{class:"energy-modal-buttons"},[o("button",{onClick:V,class:"energy-modal-btn energy-claim-btn"}," ğŸ é¢†å–ä½“åŠ› +10 "),o("button",{onClick:F,class:"energy-modal-btn energy-rest-btn"}," ä¼‘æ¯ä¸€ä¸‹ ")])])])):A("",!0),G.value?(d(),v("div",ss,[...t[10]||(t[10]=[o("div",{class:"game-card text-center"},[o("div",{class:"text-4xl animate-spin mb-4"},"â³"),o("p",{class:"text-gray-600"},"æ­£åœ¨åŠ è½½å…³å¡...")],-1)])])):A("",!0)])}}},ls=ft(as,[["__scopeId","data-v-368c7cb2"]]);export{ls as default};
