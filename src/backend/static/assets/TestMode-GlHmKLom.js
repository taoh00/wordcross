import{_ as J,l as K,o as O,a as n,c as i,b as s,n as y,p as Q,t as o,f as S,F as g,r as m,s as U,q as W,h as v,i as C,k as X}from"./index-DYfv8LOO.js";const Y={class:"test-mode-screen"},Z={class:"top-bar"},ss=["disabled"],es={key:0,class:"summary-stats"},ts={class:"stat-card"},as={class:"stat-value"},os={class:"stat-card"},ls={class:"stat-value"},ns={class:"stat-card success"},is={class:"stat-value"},cs={class:"category-tabs"},ds=["onClick"],rs={class:"group-selector"},us=["onClick"],vs={class:"group-name"},_s={class:"group-stats"},ps={key:1,class:"loading-state"},gs={key:2,class:"levels-container"},ms={class:"levels-header"},fs={class:"levels-title"},hs={class:"page-controls"},ys=["disabled"],ws={class:"page-info"},ks=["disabled"],bs={class:"levels-grid"},Cs=["onClick"],xs={class:"level-header"},$s={class:"level-info"},Ls={class:"level-num"},js={class:"grid-badge"},Ps={class:"word-badge"},Ts={class:"expand-icon"},zs={class:"answer-section"},Ms={class:"words-section"},Gs={class:"words-group"},Ss={class:"words-title"},Bs={class:"words-list"},Es={class:"word-num"},Vs={class:"word-text"},Ds={class:"word-def"},Fs={class:"words-group"},Hs={class:"words-title"},Ns={class:"words-list"},Rs={class:"word-num"},qs={class:"word-text"},As={class:"word-def"},Is={key:3,class:"empty-state"},w=20,Js={__name:"TestMode",setup(Ks){const B=X(),x=v(!1),k=v(!1),_=v(null),f=v(null),E=[{code:"primary",name:"å°å­¦",icon:"ğŸ“š"},{code:"junior",name:"åˆä¸­",icon:"ğŸ“–"},{code:"senior",name:"é«˜ä¸­",icon:"ğŸ“•"},{code:"exam",name:"è€ƒè¯•",icon:"ğŸ¯"}],b=v("primary"),p=v(""),$=v([]),r=v([]),u=v(1),V={å°å­¦:"primary",åˆä¸­:"junior",é«˜ä¸­:"senior",è€ƒè¯•:"exam"},h=C(()=>$.value.filter(a=>a.category===b.value)),D=C(()=>{const a=$.value.find(e=>e.code===p.value);return a?a.name:""}),L=C(()=>Math.ceil(r.value.length/w)),F=C(()=>{const a=(u.value-1)*w;return r.value.slice(a,a+w)});async function z(){k.value=!0;try{const a=await fetch("/data/levels_summary.json");if(!a.ok)throw new Error(`HTTP ${a.status}`);const e=await a.json();e&&e.groups&&(f.value={available:!0,...e},$.value=e.groups.map(t=>({code:t.group_code,name:t.group_name,category:V[t.category]||"exam",levels:t.level_count,words:t.word_count,coverage:t.coverage||0})),h.value.length>0&&!p.value&&j(h.value[0].code))}catch(a){console.error("åŠ è½½æ±‡æ€»æ•°æ®å¤±è´¥:",a)}finally{k.value=!1}}async function j(a){p.value=a,u.value=1,_.value=null,await H(a)}async function H(a){x.value=!0,r.value=[];try{const e=await fetch(`/data/levels/${a}/meta.json`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const c=(await e.json()).level_count||0,d=[];for(let l=1;l<=c;l++)d.push({level:l,loaded:!1,words:[],grid_size:0});r.value=d,await P(a)}catch(e){console.error("åŠ è½½å…³å¡æ•°æ®å¤±è´¥:",e)}finally{x.value=!1}}async function P(a){const e=(u.value-1)*w,t=Math.min(e+w,r.value.length),c=[];for(let d=e;d<t;d++){const l=r.value[d];l&&!l.loaded&&c.push(N(a,l.level,d))}c.length>0&&await Promise.all(c)}async function N(a,e,t){try{const c=await fetch(`/data/levels/${a}/${e}.json`);if(!c.ok)return;const d=await c.json();d&&r.value[t]&&(r.value[t]={...d,loaded:!0})}catch(c){console.warn(`åŠ è½½å…³å¡ ${a}/${e} å¤±è´¥:`,c)}}K(b,()=>{h.value.length>0?j(h.value[0].code):(p.value="",r.value=[])});function R(a){_.value=_.value===a?null:a}async function q(){u.value>1&&(u.value--,_.value=null,await P(p.value))}async function A(){u.value<L.value&&(u.value++,_.value=null,await P(p.value))}function I(){B.push("/")}return O(()=>{z()}),(a,e)=>(n(),i("div",Y,[s("div",Z,[s("button",{onClick:I,class:"back-btn"},"â† è¿”å›"),e[2]||(e[2]=s("h1",{class:"page-title"},"ğŸ“‹ å…³å¡æ•°æ®æŸ¥çœ‹",-1)),s("button",{onClick:z,disabled:k.value,class:"refresh-btn"},[s("span",{class:y({spinning:k.value})},"ğŸ”„",2),e[1]||(e[1]=Q(" åˆ·æ–° ",-1))],8,ss)]),f.value?(n(),i("div",es,[s("div",ts,[e[3]||(e[3]=s("div",{class:"stat-icon"},"ğŸ“š",-1)),s("div",as,o(f.value.total_groups||0),1),e[4]||(e[4]=s("div",{class:"stat-label"},"è¯åº“åˆ†ç»„",-1))]),s("div",os,[e[5]||(e[5]=s("div",{class:"stat-icon"},"ğŸ®",-1)),s("div",ls,o(f.value.total_levels||0),1),e[6]||(e[6]=s("div",{class:"stat-label"},"æ€»å…³å¡æ•°",-1))]),s("div",ns,[e[7]||(e[7]=s("div",{class:"stat-icon"},"âœ…",-1)),s("div",is,o(f.value.success_count||0),1),e[8]||(e[8]=s("div",{class:"stat-label"},"æˆåŠŸç”Ÿæˆ",-1))])])):S("",!0),s("div",cs,[(n(),i(g,null,m(E,t=>s("button",{key:t.code,class:y(["category-tab",{active:b.value===t.code}]),onClick:c=>b.value=t.code},o(t.icon)+" "+o(t.name),11,ds)),64))]),s("div",rs,[(n(!0),i(g,null,m(h.value,t=>(n(),i("button",{key:t.code,class:y(["group-btn",{active:p.value===t.code}]),onClick:c=>j(t.code)},[s("span",vs,o(t.name),1),s("span",_s,o(t.levels)+"å…³ Â· "+o(t.coverage)+"%",1)],10,us))),128))]),x.value?(n(),i("div",ps,[...e[9]||(e[9]=[s("div",{class:"spinner"},"â³",-1),s("p",null,"æ­£åœ¨åŠ è½½å…³å¡æ•°æ®...",-1)])])):r.value.length>0?(n(),i("div",gs,[s("div",ms,[s("span",fs,"ğŸ“š "+o(D.value)+" Â· å…± "+o(r.value.length)+" å…³",1),s("div",hs,[s("button",{onClick:q,disabled:u.value===1,class:"page-btn"},"â€¹",8,ys),s("span",ws,o(u.value)+" / "+o(L.value),1),s("button",{onClick:A,disabled:u.value===L.value,class:"page-btn"},"â€º",8,ks)])]),s("div",bs,[(n(!0),i(g,null,m(F.value,t=>{var c,d;return n(),i("div",{key:t.level,class:y(["level-card",{expanded:_.value===t.level}]),onClick:l=>R(t.level)},[s("div",xs,[s("div",$s,[s("span",Ls,"ç¬¬"+o(t.level)+"å…³",1),s("span",js,o(t.grid_size)+"Ã—"+o(t.grid_size),1),s("span",Ps,o(t.word_count)+"è¯",1)]),s("span",Ts,o(_.value===t.level?"â–¼":"â–¶"),1)]),_.value===t.level?(n(),i("div",{key:0,class:"level-details",onClick:e[0]||(e[0]=U(()=>{},["stop"]))},[s("div",zs,[e[10]||(e[10]=s("div",{class:"section-title"},"ğŸ“ ç­”æ¡ˆç½‘æ ¼",-1)),e[11]||(e[11]=s("div",{class:"grid-legend"},[s("span",{class:"legend-item prefilled"},"ğŸŸ¡ é¢„å¡«"),s("span",{class:"legend-item normal"},"ğŸŸ£ å¾…å¡«")],-1)),s("div",{class:"answer-grid",style:W({gridTemplateColumns:`repeat(${t.grid_size}, 1fr)`})},[(n(!0),i(g,null,m(t.answer_grid,(l,T)=>(n(),i("div",{key:"row-"+T,class:"grid-row"},[(n(!0),i(g,null,m(l,(M,G)=>(n(),i("div",{key:"cell-"+T+"-"+G,class:y(["grid-cell",{empty:M===null,prefilled:t.prefilled&&t.prefilled[T+"-"+G]}])},o(M||""),3))),128))]))),128))],4)]),s("div",Ms,[s("div",Gs,[s("div",Ss,"â†’ æ¨ªå‘ ("+o(((c=t.across_words)==null?void 0:c.length)||0)+")",1),s("div",Bs,[(n(!0),i(g,null,m(t.across_words,l=>(n(),i("div",{key:"a-"+l.id,class:"word-item"},[s("span",Es,o(l.clue_number)+".",1),s("span",Vs,o(l.word),1),s("span",Ds,o(l.definition),1)]))),128))])]),s("div",Fs,[s("div",Hs,"â†“ çºµå‘ ("+o(((d=t.down_words)==null?void 0:d.length)||0)+")",1),s("div",Ns,[(n(!0),i(g,null,m(t.down_words,l=>(n(),i("div",{key:"d-"+l.id,class:"word-item"},[s("span",Rs,o(l.clue_number)+".",1),s("span",qs,o(l.word),1),s("span",As,o(l.definition),1)]))),128))])])])])):S("",!0)],10,Cs)}),128))])])):(n(),i("div",Is,[...e[12]||(e[12]=[s("div",{class:"empty-icon"},"ğŸ“­",-1),s("p",null,"è¯·é€‰æ‹©ä¸€ä¸ªè¯åº“æŸ¥çœ‹å…³å¡æ•°æ®",-1)])]))]))}},Qs=J(Js,[["__scopeId","data-v-761eda2c"]]);export{Qs as default};
